"use strict";(self.webpackChunkpolity=self.webpackChunkpolity||[]).push([[985],{2985:(Nt,F,a)=>{a.r(F),a.d(F,{ChatModule:()=>yt});var p=a(6895),f=a(977),N=a(9028),l=a(5861),m=a(805),e=a(1571),w=a(2653),d=a(2340),I=a(6923);let K=(()=>{class n{constructor(t){this.authentificationQuery=t,this.supabaseClient=(0,w.eI)(d.N.supabaseUrl,d.N.supabaseKey),this.authSubscription=this.authentificationQuery.uuid$.subscribe(i=>{this.loggedInID=i})}ngOnDestroy(){this.authSubscription&&this.authSubscription.unsubscribe()}resetNumberOfUnreadMessages(t,i){var s=this;return(0,l.Z)(function*(){const o=yield s.supabaseClient.rpc("reset_number_of_unread_messages",{room_id_in:t,user_id_of_reader:i});if(o.error)throw new Error(o.error.message);return o})()}resetNumberOfUnreadMessagesOfGroup(t,i){var s=this;return(0,l.Z)(function*(){const o=yield s.supabaseClient.rpc("reset_number_of_unread_messages_in_group",{group_id_in:t,user_id_of_reader:i});if(o.error)throw new Error(o.error.message);return o})()}sendMessage(t,i,s,o,c){var g=this;return(0,l.Z)(function*(){console.log("called");let y="";g.loggedInID&&(y=g.loggedInID);const b=yield g.supabaseClient.rpc("send_message_transaction",{room_id_in:t,message_sender:y,message_receiver:i,content_in:s,is_group:o,group_id_in:c});if(b.error)throw new Error(b.error.message);return console.log("ended no error"),b})()}checkIfChatPartnerAcceptedRequest(t,i){var s=this;return(0,l.Z)(function*(){const o=yield s.supabaseClient.from("rooms_participants").select("accepted").eq("room_id",t).eq("user_id",i).single();if(o.error)throw new Error(o.error.message);return o})()}acceptChatRequest(t,i){var s=this;return(0,l.Z)(function*(){const o=yield s.supabaseClient.rpc("accept_chat_request",{room_id_in:t,user_id_of_reader:i});if(o.error)throw new Error(o.error.message);return o})()}getChatPartner(t){var i=this;return(0,l.Z)(function*(){let s="";i.loggedInID&&(s=i.loggedInID);const o=yield i.supabaseClient.rpc("select_chat_partner",{message_sender:s,room_id_in:t});if(o.error)throw new Error(o.error.message);return o})()}rejectChatRequest(t,i,s){var o=this;return(0,l.Z)(function*(){const c=yield o.supabaseClient.rpc("reject_chat_request_transaction",{room_id_in:t,follower_id:i,following_id:s});if(c.error)throw new Error(c.error.message);return c})()}getGroupAsChatPartner(t){var i=this;return(0,l.Z)(function*(){const s=yield i.supabaseClient.rpc("select_group_as_chat_partner",{room_id_in:t});if(s.error)throw new Error(s.error.message);return s})()}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(I.c))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var v=a(19),Z=a(7607);let k=(()=>{class n extends v.AE{constructor(t){super(t),this.store=t,this.messages$=this.select(i=>i.messages)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(Z.n))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var $=a(7579);let j=(()=>{class n{constructor(t,i){this.chatRoomStore=t,this.chatRoomQuery=i,this.newMessageOfUserNotifier=new $.x,this.supabaseClient=(0,w.eI)(d.N.supabaseUrl,d.N.supabaseKey)}getAllMessagesOfChat(t,i,s){var o=this;return(0,l.Z)(function*(){const c=yield o.supabaseClient.rpc("select_all_messages_of_room",{room_id_in:t}).order("created_at_in",{ascending:!1});if(c.data&&o.chatRoomStore.update({messages:c.data}),c.error)throw new Error(c.error.message);return c})()}getRealTimeChangesMessages(t){return this.supabaseClient.channel(`rooms_messages:room_id=eq.${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"rooms_messages"},s=>{const o={message_id:s.new.message_id,created_at_in:s.new.created_at,sender_id:s.new.user_id,content_in:s.new.content};this.chatRoomStore.update(c=>{let g=c.messages;g.push(o),c.messages=g}),this.newMessageOfUserNotifier.next(o.sender_id)}).subscribe()}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(Z.n),e.LFG(k))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var W=a(5754),X=a(8451),ee=a(9466),te=a(2545),A=a(9496),u=a(433),_=a(8271),O=a(1740),T=a(5593),M=a(8092),ne=a(9469);function ie(n,r){if(1&n&&(e.TgZ(0,"h4",5),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(t.message.sender_id)}}const se=function(n){return{"flex flex-row-reverse":n}},re=function(n,r){return{"primary-container":n," neutral-90":r}};let oe=(()=>{class n{constructor(){this.showSender=!1,this.loggedInUserId="",this.messageOfLoggedInUser=!1}ngOnInit(){this.checkIfMessageFromLoggedInUser()}checkIfMessageFromLoggedInUser(){this.loggedInUserId===this.message.sender_id&&(this.messageOfLoggedInUser=!0)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-message"]],inputs:{message:"message",showSender:"showSender",loggedInUserId:"loggedInUserId"},decls:8,vars:13,consts:[[3,"ngClass"],[1,"w-9","p-4","border-round","mb-2",3,"ngClass"],["class","my-0 on-light-surface-in-dark-theme",4,"ngIf"],[1,"mt-1","on-light-surface-in-dark-theme"],[1,"w-full","mb-0","text-right","on-light-surface-in-dark-theme"],[1,"my-0","on-light-surface-in-dark-theme"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,ie,2,1,"h4",2),e.TgZ(3,"p",3),e._uU(4),e.qZA(),e.TgZ(5,"p",4),e._uU(6),e.ALo(7,"date"),e.qZA()()()),2&t&&(e.Q6J("ngClass",e.VKq(8,se,i.messageOfLoggedInUser)),e.xp6(1),e.Q6J("ngClass",e.WLB(10,re,i.messageOfLoggedInUser,!i.messageOfLoggedInUser)),e.xp6(1),e.Q6J("ngIf",i.showSender),e.xp6(2),e.Oqu(i.message.content_in),e.xp6(2),e.Oqu(e.xi3(7,5,i.message.created_at_in,"HH:mm:ss")))},dependencies:[p.mk,p.O5,p.uU]}),n})();var C=a(7296);const ae=["hello"],ce=["test1"],le=["messages"];function pe(n,r){if(1&n&&(e.TgZ(0,"p",21),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.MGl("routerLink","/profile/",t.profile.id,""),e.xp6(1),e.Oqu(t.profile.name)}}function ue(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",15)(1,"div",16),e.YNc(2,pe,2,2,"p",17),e.TgZ(3,"a",18),e._UZ(4,"p-avatar",19),e.qZA()(),e.TgZ(5,"i",20),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.rejectRequest())}),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.profile),e.xp6(1),e.MGl("routerLink","/profile/",t.profile.id,""),e.xp6(1),e.s9C("image",t.profile.avatar_url)}}function me(n,r){if(1&n&&(e.TgZ(0,"p",23),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Oqu(t.group.name)}}function de(n,r){if(1&n&&(e.TgZ(0,"div",15)(1,"div",16),e.YNc(2,me,2,1,"p",22),e.TgZ(3,"a",18),e._UZ(4,"p-avatar",19),e.qZA()()()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.group),e.xp6(1),e.MGl("routerLink","/groups/",t.group.id,""),e.xp6(1),e.s9C("image",t.group.avatar_url)}}function he(n,r){1&n&&(e.TgZ(0,"div")(1,"p",25),e._uU(2,"Ihr habt euch noch keine Nachrichten geschrieben."),e.qZA()())}function ge(n,r){if(1&n&&(e.TgZ(0,"div"),e._UZ(1,"app-message",30),e.qZA()),2&n){const t=r.$implicit,i=e.oxw(4);e.xp6(1),e.Q6J("message",t)("loggedInUserId",i.loggedInUserId)}}function fe(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",26,27),e.NdJ("scrolledUp",function(){e.CHM(t);const s=e.oxw(3);return e.KtG(s.onScrollUp())})("scrolled",function(){e.CHM(t);const s=e.oxw(3);return e.KtG(s.onScrollDown())}),e.YNc(2,ge,2,2,"div",28),e.TgZ(3,"div",null,29),e._uU(5,"last element"),e.qZA()()}if(2&n){const t=e.oxw(3);e.Q6J("infiniteScrollDistance",1)("infiniteScrollUpDistance",1.5)("infiniteScrollThrottle",50),e.xp6(2),e.Q6J("ngForOf",t.messagesOfChat.slice(t.paginationData.from,t.paginationData.to))}}function _e(n,r){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,he,3,0,"div",7),e.YNc(2,fe,6,4,"div",24),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",0===t.messagesOfChat.length),e.xp6(1),e.Q6J("ngIf",t.messagesOfChat.length>0)}}function ve(n,r){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,_e,3,2,"div",7),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.messagesOfChat)}}function Ce(n,r){1&n&&(e.TgZ(0,"div")(1,"p",25),e._uU(2,"Deine Anfrage wurde noch nicht akzeptiert."),e.qZA()())}function ye(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div")(1,"div",25)(2,"div",31)(3,"p"),e._uU(4,"Du hast eine neue Chat-Anfrage. Wie m\xf6chtest du reagieren?"),e.qZA(),e.TgZ(5,"div",32)(6,"button",33),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.acceptRequestAndFollow())}),e.qZA()(),e.TgZ(7,"div",32)(8,"button",34),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.acceptRequest())}),e.qZA()(),e.TgZ(9,"div",32)(10,"button",35),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.rejectRequest())}),e.qZA()()()()()}}let be=(()=>{class n{constructor(t,i,s,o,c,g,y,b,bt,wt,It,Tt,St,xt){this.chatService=t,this.chatRoomQuery=i,this.chatRoomService=s,this.authentificationQuery=o,this.route=c,this.profileService=g,this.profileQuery=y,this.followingService=b,this.groupsService=bt,this.router=wt,this.messageService=It,this.chatRoomStore=Tt,this.renderer=St,this.paginationService=xt,this.name="",this.avatarUrl="",this.message="",this.selectedRoomId="",this.loggedInUserId="",this.messagesOfChat=[],this.isGroup=!1,this.chatPartner="",this.testBoolean=!0,this.chatPartnerAcceptedRequest=!0,this.loggedInUserAcceptedRequest=!0,this.enquirer=!1,this.scrolledDown=!0,this.loadingInitial=!1,this.error=!1,this.checkView=!0,this.paginationData={from:0,to:10,canLoad:!0,reloadDelay:2e3,sizeOfNewLoad:10,numberOfSearchResults:0}}ngOnInit(){this.getSelectedId(),this.getLoggedInUserId(),this.scrollNotifierSubscription=this.chatRoomService.newMessageOfUserNotifier.subscribe(t=>{this.checkView=!0,console.log("Please scroll"),console.log("Please reset counter"),console.log("in my prop"),console.log("sender_id"),console.log(t),console.log("logged in"),console.log(this.loggedInUserId),this.paginationData.to=this.paginationData.to+1,t!==this.loggedInUserId&&(console.log("reset because other id"),this.resetUnreadMessageCounterWhileChatOpen())}),this.getChatPartner(),this.loadInitialData(),this.MyProp||console.log("undefined")}ngAfterViewChecked(){console.log(window.scrollY),console.log(this.paginationData.from),console.log(this.paginationData.to),this.testBoolean&&(console.log("called"),console.log(this.testBoolean),this.testBoolean=!0,this.MyProp1&&this.checkView&&this.renderer.selectRootElement(this.MyProp1.nativeElement).scrollIntoView())}ngOnDestroy(){this.authSubscription&&this.authSubscription.unsubscribe(),this.profileSubscription&&this.profileSubscription.unsubscribe(),this.messageRealtimeChannel&&this.messageRealtimeChannel.unsubscribe(),this.messageSubscription&&this.messageSubscription.unsubscribe(),this.scrollNotifierSubscription&&this.scrollNotifierSubscription.unsubscribe()}resetUnreadMessageCounterWhileChatOpen(){var t=this;return(0,l.Z)(function*(){try{t.loggedInUserId&&(yield t.chatService.resetNumberOfUnreadMessages(t.selectedRoomId,t.chatPartner))}catch(i){t.messageService.add({severity:"error",summary:i.message})}})()}loadInitialData(){var t=this;return(0,l.Z)(function*(){try{t.loadingInitial=!0,t.error=!1,yield t.chatRoomService.getAllMessagesOfChat(t.selectedRoomId,t.paginationData.from,t.paginationData.to),t.messageSubscription=t.chatRoomQuery.messages$.subscribe(i=>{t.messagesOfChat=i.reverse(),t.paginationData.from=t.messagesOfChat.length-10,t.paginationData.to=t.messagesOfChat.length,console.log("initial"),console.log(t.paginationData.from),console.log(t.paginationData.to),t.MyProp||console.log("undefined")}),t.messageRealtimeChannel=t.chatRoomService.getRealTimeChangesMessages(t.selectedRoomId)}catch(i){t.error=!0,t.errorMessage=i.message,t.messageService.add({severity:"error",summary:i.message})}finally{t.loadingInitial=!1,console.log("called finally"),t.MyProp1?(console.log("found in finally"),t.renderer.selectRootElement(t.MyProp1.nativeElement).scrollIntoView()):console.log("undefined")}})()}onScrollDown(){console.log("scrolled down!!"),this.loadNewData()}onScrollUp(){console.log("scrolled up!!"),this.loadNewData(),console.log("from")}loadNewData(){this.checkView=!1,this.paginationData=this.paginationService.scrollUpAndLoadDescending(this.paginationData)}getSelectedId(){this.route.paramMap.subscribe(t=>{this.selectedRoomId=String(t.get("id"))})}onSendMessage(){var t=this;return(0,l.Z)(function*(){let i;i=t.group?t.group.id:void 0;try{yield t.chatService.sendMessage(t.selectedRoomId,t.chatPartner,t.message,t.isGroup,i),t.message=""}catch(s){t.messageService.add({severity:"error",summary:s.message})}finally{console.log("finnaly message send"),t.MyProp1&&console.log("in my prop")}})()}getLoggedInUserId(){this.authSubscription=this.authentificationQuery.uuid$.subscribe(t=>{this.loggedInUserId=t})}getProfile(){this.profileService.upsert(this.chatPartner),this.profileSubscription=this.profileQuery.selectEntity(this.chatPartner).subscribe(t=>{t&&(this.profile=t)})}getGroup(){var t=this;return(0,l.Z)(function*(){try{const i=yield t.groupsService.selectGroup(t.chatPartner);t.group=i.data}catch(i){t.messageService.add({severity:"error",summary:i.message})}})()}getChatPartner(){var t=this;return(0,l.Z)(function*(){try{const i=yield t.chatService.getChatPartner(t.selectedRoomId);if(t.chatPartner=i.data,t.chatPartner){t.isGroup=!1,t.getProfile();try{t.loggedInUserId&&t.chatService.resetNumberOfUnreadMessages(t.selectedRoomId,t.chatPartner)}catch(s){t.messageService.add({severity:"error",summary:s.message})}}else try{t.isGroup=!0;const s=yield t.chatService.getGroupAsChatPartner(t.selectedRoomId);t.chatPartner=s.data,t.getGroup()}catch(s){t.messageService.add({severity:"error",summary:s.message})}t.checkIfChatPartnerAcceptedRequest(),t.checkIfChatLoggedInUserAcceptedRequest()}catch(i){t.messageService.add({severity:"error",summary:i.message})}})()}checkIfChatPartnerAcceptedRequest(){var t=this;return(0,l.Z)(function*(){try{const i=yield t.chatService.checkIfChatPartnerAcceptedRequest(t.selectedRoomId,t.chatPartner);t.chatPartnerAcceptedRequest=i.data.accepted}catch(i){t.messageService.add({severity:"error",summary:i.message})}})()}checkIfChatLoggedInUserAcceptedRequest(){var t=this;return(0,l.Z)(function*(){try{if(t.loggedInUserId){const i=yield t.chatService.checkIfChatPartnerAcceptedRequest(t.selectedRoomId,t.loggedInUserId);t.loggedInUserAcceptedRequest=i.data.accepted}}catch(i){t.messageService.add({severity:"error",summary:i.message})}})()}acceptRequestAndFollow(){var t=this;return(0,l.Z)(function*(){try{yield t.followingService.followTransaction(t.chatPartner),t.loggedInUserAcceptedRequest=!0}catch(i){t.messageService.add({severity:"error",summary:i.message})}})()}acceptRequest(){var t=this;return(0,l.Z)(function*(){try{t.loggedInUserId&&(yield t.chatService.acceptChatRequest(t.selectedRoomId,t.loggedInUserId),t.loggedInUserAcceptedRequest=!0)}catch(i){t.messageService.add({severity:"error",summary:i.message})}})()}rejectRequest(){var t=this;return(0,l.Z)(function*(){try{t.loggedInUserId&&(yield t.chatService.rejectChatRequest(t.selectedRoomId,t.chatPartner,t.loggedInUserId),t.loggedInUserAcceptedRequest=!1,t.router.navigate(["/orga"]))}catch(i){t.messageService.add({severity:"error",summary:i.message})}})()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(K),e.Y36(k),e.Y36(j),e.Y36(I.c),e.Y36(f.gz),e.Y36(W.H),e.Y36(X.w),e.Y36(ee.J),e.Y36(te.J),e.Y36(f.F0),e.Y36(m.ez),e.Y36(Z.n),e.Y36(e.Qsj),e.Y36(A.a))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-chat-room"]],viewQuery:function(t,i){if(1&t&&(e.Gf(ae,5),e.Gf(ce,5),e.Gf(le,5)),2&t){let s;e.iGM(s=e.CRH())&&(i.MyProp=s.first),e.iGM(s=e.CRH())&&(i.MyProp1=s.first),e.iGM(s=e.CRH())&&(i.content=s.first)}},inputs:{name:"name",avatarUrl:"avatarUrl"},features:[e._Bn([m.ez])],decls:19,vars:10,consts:[[1,"fixed","w-full","top-fixed","surface"],[1,"flex"],["data-cy","backButton",1,"",3,"title","link"],["class","flex align-items-center w-full",4,"ngIf"],[3,"noTopBar"],["slot","main"],[1,"mb-8"],[4,"ngIf"],["slot","side"],[1,"fixed","w-full","p-3","bottom-fixed","left-0","background-color"],[3,"ngSubmit"],["messageForm","ngForm"],[1,"p-float-label"],["data-cy","send-message","name","message","id","message","type","text","pInputText","",1,"w-full","p-inputtext",3,"ngModel","disabled","ngModelChange"],["for","message"],[1,"flex","align-items-center","w-full"],[1,"w-full","flex","justify-content-end"],["class","flex align-items-center cursor-pointer",3,"routerLink",4,"ngIf"],[1,"flex","align-items-center","ml-5","mr-5","cursor-pointer",3,"routerLink"],["shape","circle","styleClass","border-round",1,"border-round","flex","align-items-center","justify-content-center",3,"image"],["data-cy","delete-chat",1,"cursor-pointer","pi","pi-times","align-items-center","flex","justify-content-center","mr-4","on-dark-surface-in-dark-theme",3,"click"],[1,"flex","align-items-center","cursor-pointer",3,"routerLink"],["class","flex align-items-center",4,"ngIf"],[1,"flex","align-items-center"],["class","search-results mt-8 margin-bottom","infiniteScroll","",3,"infiniteScrollDistance","infiniteScrollUpDistance","infiniteScrollThrottle","scrolledUp","scrolled",4,"ngIf"],[1,"text-center","margin-mid"],["infiniteScroll","",1,"search-results","mt-8","margin-bottom",3,"infiniteScrollDistance","infiniteScrollUpDistance","infiniteScrollThrottle","scrolledUp","scrolled"],["messages",""],[4,"ngFor","ngForOf"],["test1",""],[3,"message","loggedInUserId"],[1,"flex","flex-column"],[1,"flex","justify-content-center"],["pButton","","type","button","label","Akzeptieren & Folgen",1,"fit-content","p-button-raised",3,"click"],["pButton","","type","button","label","Nur akzeptieren",1,"fit-content","p-button-text",3,"click"],["pButton","","type","button","label","Ablehnen",1,"fit-content","p-button-text","p-button-danger",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"app-back-button",2),e.YNc(3,ue,6,3,"div",3),e.YNc(4,de,5,3,"div",3),e.qZA()(),e.TgZ(5,"app-wrapper-grid",4)(6,"div",5)(7,"div",6),e.YNc(8,ve,2,1,"div",7),e.YNc(9,Ce,3,0,"div",7),e.YNc(10,ye,11,0,"div",7),e.qZA()(),e._UZ(11,"div",8),e.qZA(),e.TgZ(12,"div",9)(13,"form",10,11),e.NdJ("ngSubmit",function(){return i.onSendMessage()}),e.TgZ(15,"span",12)(16,"input",13),e.NdJ("ngModelChange",function(o){return i.message=o}),e.qZA(),e.TgZ(17,"label",14),e._uU(18,"Neue Nachricht"),e.qZA()()()()),2&t&&(e.xp6(2),e.Q6J("title","Zur\xfcck")("link","/orga"),e.xp6(1),e.Q6J("ngIf",i.profile),e.xp6(1),e.Q6J("ngIf",i.group),e.xp6(1),e.Q6J("noTopBar",!0),e.xp6(3),e.Q6J("ngIf",i.loggedInUserAcceptedRequest&&i.chatPartnerAcceptedRequest),e.xp6(1),e.Q6J("ngIf",i.loggedInUserAcceptedRequest&&!i.chatPartnerAcceptedRequest),e.xp6(1),e.Q6J("ngIf",!i.loggedInUserAcceptedRequest&&i.chatPartnerAcceptedRequest),e.xp6(6),e.Q6J("ngModel",i.message)("disabled",!i.chatPartnerAcceptedRequest||!i.loggedInUserAcceptedRequest))},dependencies:[p.sg,p.O5,f.rH,u._Y,u.Fj,u.JJ,u.JL,u.On,u.F,_.q,O.o,T.Hq,M.V,ne.W,oe,C.Ry],styles:[".bottom-fixed[_ngcontent-%COMP%]{bottom:4rem}.top-fixed[_ngcontent-%COMP%]{left:0rem;top:0rem;padding-left:2rem}.margin-mid[_ngcontent-%COMP%]{margin-top:40vh}.margin-bottom[_ngcontent-%COMP%]{margin-bottom:10rem}@media only screen and (min-width: 1024px){.bottom-fixed[_ngcontent-%COMP%]{padding-left:15rem!important;padding-right:5rem!important;bottom:0rem!important}.top-fixed[_ngcontent-%COMP%]{padding-left:16rem;padding-right:16rem}.margin-bottom[_ngcontent-%COMP%]{margin-bottom:10rem!important}}"]}),n})();const L=[{label:"CHAT",routerLink:["/orga"],routerLinkActiveOptions:{exact:!0},id:"chat-cy"},{label:"NEWS",routerLink:["/orga/news"],routerLinkActiveOptions:{exact:!0},id:"news-cy"}],D=[{icon:"pi pi-fw pi-comments",routerLink:["/orga"],routerLinkActiveOptions:{exact:!0},id:"chat-cy-mob"},{icon:"pi pi-fw pi-bell",routerLink:["/orga/news"],routerLinkActiveOptions:{exact:!0},id:"news-cy-mob"}];var U=a(4004),J=a(6943);let Q=(()=>{class n extends v.Gv{constructor(t){super(t),this.store=t,this.allChats$=this.selectAll()}filterData(t,i){let s=this.allChats$;return i&&(s=s.pipe((0,U.U)(o=>o.filter(c=>!0===c.is_group)))),""!==t&&(s=s.pipe((0,U.U)(o=>o.filter(c=>c.name.includes(t))))),s}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(J.w))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),we=(()=>{class n{constructor(t,i,s){this.chatQuery=t,this.authentificationQuery=i,this.chatStore=s,this.supabaseClient=(0,w.eI)(d.N.supabaseUrl,d.N.supabaseKey)}ngOnDestroy(){this.authSubscription&&this.authSubscription.unsubscribe(),this.authSubscription2&&this.authSubscription2.unsubscribe(),this.authSubscription&&this.authSubscription.unsubscribe()}selectAllRoomsOfUser(){var t=this;return(0,l.Z)(function*(){let i="";t.authSubscription=t.authentificationQuery.uuid$.subscribe(o=>{i=o});const s=yield t.supabaseClient.rpc("select_all_rooms_of_user",{user_id_in:i});if(s.data){const o=s.data;t.chatStore.reset(),t.chatStore.add(o)}if(s.error)throw new Error(s.error.message);return s})()}add(t){this.chatStore.add(t)}update(t,i){this.chatStore.update(t,i)}remove(t){this.chatStore.remove(t)}getRealTimeChangesOnNewFollow(){let t="";return this.authSubscription2=this.authentificationQuery.uuid$.subscribe(s=>{t=s}),this.supabaseClient.channel(`following_profile_system:following=eq.${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"following_profile_system"},s=>{console.log(),console.log(s),this.selectAllRoomsOfUser()}).subscribe()}getRealTimeChanges(){this.chatQuery.allChats$.subscribe(t=>{t.forEach(i=>{let s=i.id;return this.supabaseClient.channel(`rooms:id=eq.${s}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"rooms"},c=>{this.chatStore.update(s,{last_message:c.new.last_message,last_message_time:c.new.last_message_time})}).on("postgres_changes",{event:"INSERT",schema:"public",table:"rooms"},c=>{console.log("INSERT"),console.log("payload"),console.log(c)}).on("postgres_changes",{event:"DELETE",schema:"public",table:"rooms"},c=>{console.log("DELETE"),console.log("Payload"),console.log(c),this.chatStore.remove(c.new.id)}).subscribe()}),t.forEach(i=>{let s=i.id;return this.supabaseClient.channel(`public:rooms_participants:room_id=eq.${s}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"rooms_participants"},c=>{this.chatStore.update(s,{number_of_unread_messages:c.new.number_of_unread_messages})}).subscribe()})})}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(Q),e.LFG(I.c),e.LFG(J.w))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var S=a(7147),P=a(4479),E=a(4524),q=a(8639);function Ie(n,r){1&n&&e._UZ(0,"i",14)}function Te(n,r){if(1&n&&e._UZ(0,"p-badge",15),2&n){const t=e.oxw();e.Q6J("value",t.unreadMessagesAsString)}}function Se(n,r){if(1&n&&(e.TgZ(0,"p",16),e._uU(1),e.ALo(2,"date"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,1,t.chat.last_message_time))}}function xe(n,r){if(1&n&&(e.TgZ(0,"p",16),e._uU(1),e.ALo(2,"date"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(e.xi3(2,1,t.chat.last_message_time,"HH:mm:ss"))}}let Ne=(()=>{class n{constructor(t){this.router=t,this.showTime=!1,this.unreadMessagesAsString=""}ngOnInit(){this.checkIfMessageReceivedToday(),this.convertNumberToString()}openProfile(t){this.router.navigate([`profile/${this.chat.participant_id}`])}openChat(){this.router.navigate([`orga/${this.chat.id}`])}checkIfMessageReceivedToday(){(new Date).setHours(0,0,0,0)===new Date(this.chat.last_message_time).setHours(0,0,0,0)&&(this.showTime=!0)}convertNumberToString(){this.unreadMessagesAsString=this.chat.number_of_unread_messages.toString()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(f.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-chat-list-item"]],inputs:{chat:"chat"},decls:19,vars:7,consts:[[1,"flex","w-full"],[1,"flex-space-arround","p-2","w-full"],[1,"flex","align-items-center","w-full"],[1,"flex-none","mr-5","cursor-pointer",3,"click"],["shape","circle","styleClass","border-round",3,"image"],[1,"flex-grow-1","mr-5","cursor-pointer",3,"click"],[1,"my-0"],[1,"mt-1","mb-0"],[1,"flex-none","p-2","cursor-pointer",3,"click"],[1,"flex-space-between"],[1,"text-center"],["class","pi pi-users mr-2",4,"ngIf"],["data-cy","number-of-unread-messages",3,"value",4,"ngIf"],["class","mb-0",4,"ngIf"],[1,"pi","pi-users","mr-2"],["data-cy","number-of-unread-messages",3,"value"],[1,"mb-0"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3),e.NdJ("click",function(){return i.openProfile("id")}),e._UZ(4,"p-avatar",4),e.qZA(),e.TgZ(5,"a",5),e.NdJ("click",function(){return i.openChat()}),e.TgZ(6,"h4",6),e._uU(7),e.qZA(),e.TgZ(8,"p",7),e._uU(9),e.qZA()(),e.TgZ(10,"a",8),e.NdJ("click",function(){return i.openChat()}),e.TgZ(11,"div",9)(12,"div",10)(13,"div"),e.YNc(14,Ie,1,0,"i",11),e.YNc(15,Te,1,1,"p-badge",12),e.qZA(),e.TgZ(16,"div"),e.YNc(17,Se,3,3,"p",13),e.YNc(18,xe,3,4,"p",13),e.qZA()()()()()()()),2&t&&(e.xp6(4),e.s9C("image",i.chat.avatar_url),e.xp6(3),e.Oqu(i.chat.name),e.xp6(2),e.Oqu(i.chat.last_message),e.xp6(5),e.Q6J("ngIf",i.chat.is_group),e.xp6(1),e.Q6J("ngIf",i.chat.number_of_unread_messages>0),e.xp6(2),e.Q6J("ngIf",!i.showTime),e.xp6(1),e.Q6J("ngIf",i.showTime))},dependencies:[p.O5,q.Ct,_.q,p.uU]}),n})();var Y=a(8249);function Ze(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"p-chip",17),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.setGroupFilter())}),e.qZA()}}function Ae(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"p-chip",18),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.setGroupFilter())}),e.qZA()}}function Oe(n,r){if(1&n&&(e.TgZ(0,"div"),e._UZ(1,"app-chat-list-item",21),e.qZA()),2&n){const t=r.$implicit;e.xp6(1),e.Q6J("chat",t)}}function Me(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",19),e.NdJ("scrolled",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.loadNewData())}),e.YNc(1,Oe,2,1,"div",20),e.qZA()}if(2&n){const t=e.oxw();e.Q6J("infiniteScrollDistance",1)("infiniteScrollUpDistance",1.5)("infiniteScrollThrottle",50),e.xp6(1),e.Q6J("ngForOf",t.chats.slice(t.paginationData.from,t.paginationData.to))}}let Ue=(()=>{class n{constructor(t,i,s,o){this.chatQuery=t,this.chatServiceStore=i,this.messageService=s,this.paginationService=o,this.menuItems=L,this.menuItemsMega=D,this.groupFilterOn=!1,this.searchTerm="",this.chats=[],this.loadingInitial=!1,this.error=!1,this.paginationData={from:0,to:4,canLoad:!0,reloadDelay:2e3,sizeOfNewLoad:10,numberOfSearchResults:0}}ngOnInit(){this.loadInitialData(),this.chatSubscription=this.chatQuery.allChats$.subscribe(t=>{t&&(this.chats=t,this.paginationData.numberOfSearchResults=this.chats.length)})}loadInitialData(){var t=this;return(0,l.Z)(function*(){try{t.loadingInitial=!0,t.error=!1,yield t.chatServiceStore.selectAllRoomsOfUser(),t.newFollowerRealTimeChanges=t.chatServiceStore.getRealTimeChangesOnNewFollow(),t.chatRealTimeChanges=t.chatServiceStore.getRealTimeChanges()}catch(i){t.error=!0,t.errorMessage=i.message,t.messageService.add({severity:"error",summary:i.message})}finally{t.loadingInitial=!1}})()}ngOnDestroy(){this.chatRealTimeChanges&&this.chatRealTimeChanges.unsubscribe(),this.newFollowerRealTimeChanges&&this.newFollowerRealTimeChanges.unsubscribe(),this.chatSubscription&&this.chatSubscription.unsubscribe(),this.filterGroupsSubscription&&this.filterGroupsSubscription.unsubscribe(),this.filterNameSubscription&&this.filterNameSubscription.unsubscribe()}loadNewData(){this.paginationData=this.paginationService.scrollDownAndLoadAscending(this.paginationData)}onSearch(t){this.searchTerm=t,this.filterNameSubscription=this.chatQuery.filterData(this.searchTerm,this.groupFilterOn).subscribe(i=>{this.chats=i})}setGroupFilter(){this.groupFilterOn=!this.groupFilterOn,this.filterGroupsSubscription=this.chatQuery.filterData(this.searchTerm,this.groupFilterOn).subscribe(t=>{this.chats=t})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(Q),e.Y36(we),e.Y36(m.ez),e.Y36(A.a))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-chat"]],features:[e._Bn([m.ez])],decls:19,vars:11,consts:[[3,"specialOrStandart","megaMenuItemStandart"],["slot","main"],[1,"mb-8"],[3,"submit"],[1,"grid"],[1,"col-12"],[1,"p-float-label"],["id","float-input","type","text","pInputText","","data-cy","filter-chats",1,"w-full","p-inputtext",3,"value"],["searchBar",""],["for","float-input"],[1,"w-full","text-center"],["class","","label","POLITY GRUPPEN","styleClass","cursor-pointer",3,"click",4,"ngIf"],["class","","label","POLITY GRUPPEN","styleClass","cursor-pointer accent-container",3,"click",4,"ngIf"],[3,"error","loading","errorMessage","retryAction"],["infiniteScroll","",3,"infiniteScrollDistance","infiniteScrollUpDistance","infiniteScrollThrottle","scrolled",4,"ngIf"],["slot","side"],[3,"specialOrStandart","menuItemsStandart"],["label","POLITY GRUPPEN","styleClass","cursor-pointer",1,"",3,"click"],["label","POLITY GRUPPEN","styleClass","cursor-pointer accent-container",1,"",3,"click"],["infiniteScroll","",3,"infiniteScrollDistance","infiniteScrollUpDistance","infiniteScrollThrottle","scrolled"],[4,"ngFor","ngForOf"],[3,"chat"]],template:function(t,i){if(1&t){const s=e.EpF();e._UZ(0,"app-menu-bar-secondary-top",0),e.TgZ(1,"app-wrapper-grid")(2,"div",1)(3,"div",2)(4,"form",3),e.NdJ("submit",function(){e.CHM(s);const c=e.MAs(9);return e.KtG(i.onSearch(c.value))}),e.TgZ(5,"div",4)(6,"div",5)(7,"span",6),e._UZ(8,"input",7,8),e.TgZ(10,"label",9),e._uU(11,"Search"),e.qZA()()()()(),e.TgZ(12,"div",10),e.YNc(13,Ze,1,0,"p-chip",11),e.YNc(14,Ae,1,0,"p-chip",12),e.qZA(),e.TgZ(15,"app-loading-spinner",13),e.NdJ("retryAction",function(){return i.loadInitialData()}),e.qZA(),e.YNc(16,Me,2,4,"div",14),e.qZA()(),e.TgZ(17,"div",15),e._UZ(18,"app-menu-bar-secondary-right",16),e.qZA()()}2&t&&(e.Q6J("specialOrStandart",!1)("megaMenuItemStandart",i.menuItemsMega),e.xp6(8),e.Q6J("value",""),e.xp6(5),e.Q6J("ngIf",!i.groupFilterOn),e.xp6(1),e.Q6J("ngIf",i.groupFilterOn),e.xp6(1),e.Q6J("error",i.error)("loading",i.loadingInitial)("errorMessage",i.errorMessage),e.xp6(1),e.Q6J("ngIf",!i.loadingInitial&&!i.error),e.xp6(2),e.Q6J("specialOrStandart",!1)("menuItemsStandart",i.menuItems))},dependencies:[p.sg,p.O5,u._Y,u.JL,u.F,S.A,O.o,M.V,P.e,E.U,Ne,Y.g,C.Ry]}),n})();var Re=a(5933),Fe=a(7582),ke=a(5608);let h=class extends v.Gv{constructor(r){super(r),this.store=r,this.allNews$=this.selectAll(),this.lastNews$=this.selectFirst()}filterNewsByType(r){let t=this.allNews$;return r&&(t=t.pipe((0,U.U)(i=>i.filter(s=>s.type===r)))),t}};h.\u0275fac=function(r){return new(r||h)(e.LFG(ke.W))},h.\u0275prov=e.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h=(0,Fe.gn)([(0,v.xR)({sortBy:"created_at",sortByOrder:v.KM.DESC})],h);var G=a(6679);function Le(n,r){1&n&&e._UZ(0,"p-tag",16)}function De(n,r){if(1&n&&e._UZ(0,"p-tag",17),2&n){const t=e.oxw();e.s9C("value",t.news.type)}}function Je(n,r){if(1&n&&e._UZ(0,"p-tag",18),2&n){const t=e.oxw();e.s9C("value",t.news.type)}}function Qe(n,r){if(1&n&&e._UZ(0,"p-tag",19),2&n){const t=e.oxw();e.s9C("value",t.news.type)}}function Pe(n,r){if(1&n&&e._UZ(0,"p-tag",19),2&n){const t=e.oxw();e.s9C("value",t.news.type)}}function Ee(n,r){if(1&n&&e._UZ(0,"p-tag",17),2&n){const t=e.oxw();e.s9C("value",t.news.type)}}function qe(n,r){if(1&n&&(e.TgZ(0,"p",20),e._uU(1),e.ALo(2,"date"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,1,t.news.created_at))}}function Ye(n,r){if(1&n&&(e.TgZ(0,"p",20),e._uU(1),e.ALo(2,"date"),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.hij("",e.xi3(2,1,t.news.created_at,"HH:mm:ss")," Uhr")}}let Ge=(()=>{class n{constructor(t){this.router=t,this.showTime=!1}ngOnInit(){this.checkIfMessageReceivedToday()}openProfile(){this.router.navigateByUrl(`/profile/${this.news.notifier}`)}openConnectedId(){this.router.navigateByUrl(`/profile/${this.news.notifier}`)}checkIfMessageReceivedToday(){const t=(new Date).setHours(0,0,0,0),i=new Date(this.news.created_at).setHours(0,0,0,0);console.log(t),console.log(i),t===i&&(this.showTime=!0)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(f.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-news-list-item"]],inputs:{news:"news"},decls:23,vars:12,consts:[[1,"flex","w-full"],[1,"flex-space-arround","p-2","w-full"],[1,"flex","align-items-center","w-full"],[1,"flex-none","mr-5","cursor-pointer",3,"click"],["shape","circle","styleClass","border-round",3,"image"],[1,"flex-grow-1","mr-5","cursor-pointer",3,"click"],[1,"my-0"],[1,"mt-1","mb-0"],[1,"flex-none","p-2","cursor-pointer",3,"click"],[1,"flex-space-between"],[1,"text-center"],["value","NEW","styleClass","success-container font-normal success-color mr-2",4,"ngIf"],["styleClass","primary-container font-normal primary-color",3,"value",4,"ngIf"],["styleClass","accent-container-2 font-normal accent-color-2",3,"value",4,"ngIf"],["styleClass","tertiary-container font-normal tertiary-color",3,"value",4,"ngIf"],["class","mb-0",4,"ngIf"],["value","NEW","styleClass","success-container font-normal success-color mr-2"],["styleClass","primary-container font-normal primary-color",3,"value"],["styleClass","accent-container-2 font-normal accent-color-2",3,"value"],["styleClass","tertiary-container font-normal tertiary-color",3,"value"],[1,"mb-0"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3),e.NdJ("click",function(){return i.openProfile()}),e._UZ(4,"p-avatar",4),e.qZA(),e.TgZ(5,"a",5),e.NdJ("click",function(){return i.openConnectedId()}),e.TgZ(6,"h4",6),e._uU(7),e.qZA(),e.TgZ(8,"p",7),e._uU(9),e.qZA()(),e.TgZ(10,"a",8),e.NdJ("click",function(){return i.openConnectedId()}),e.TgZ(11,"div",9)(12,"div",10)(13,"div"),e.YNc(14,Le,1,0,"p-tag",11),e.YNc(15,De,1,1,"p-tag",12),e.YNc(16,Je,1,1,"p-tag",13),e.YNc(17,Qe,1,1,"p-tag",14),e.YNc(18,Pe,1,1,"p-tag",14),e.YNc(19,Ee,1,1,"p-tag",12),e.qZA(),e.TgZ(20,"div"),e.YNc(21,qe,3,3,"p",15),e.YNc(22,Ye,3,4,"p",15),e.qZA()()()()()()()),2&t&&(e.xp6(4),e.s9C("image",i.news.avatar_url),e.xp6(3),e.AsE("",i.news.name," || ",i.news.title,""),e.xp6(2),e.Oqu(i.news.message),e.xp6(5),e.Q6J("ngIf",i.news.new),e.xp6(1),e.Q6J("ngIf","task"===i.news.type),e.xp6(1),e.Q6J("ngIf","amendment"===i.news.type),e.xp6(1),e.Q6J("ngIf","event"===i.news.type),e.xp6(1),e.Q6J("ngIf","group"===i.news.type),e.xp6(1),e.Q6J("ngIf","account"===i.news.type),e.xp6(2),e.Q6J("ngIf",!i.showTime),e.xp6(1),e.Q6J("ngIf",i.showTime))},dependencies:[p.O5,_.q,G.V,p.uU]}),n})();var x=a(2453),ze=a(9784);let He=(()=>{class n{constructor(t,i){this.swPush=t,this.authentificationQuery=i,this.VAPID_PUBLIC_KEY="BJQhdOCOkmXaJaYhaJxM69Ju6aOFdTgW0p64hpefnNZ74MFsvEu90ToMPzr5z1P9NIsAp5TS8znGgZ2DSBIOrmE",this.supabaseClient=(0,w.eI)(d.N.supabaseUrl,d.N.supabaseKey)}ngOnInit(){this.authSubscription=this.authentificationQuery.uuid$.subscribe(t=>{this.loggedInUserId=t})}subscribeToNotifications(){var t=this;return(0,l.Z)(function*(){console.log("clicked"),t.swPush.requestSubscription({serverPublicKey:t.VAPID_PUBLIC_KEY}).then(i=>{console.log("swPUsh",i),i&&t.addPushSubscriber(i).then(s=>{console.log("finished database insert",s)}).catch(s=>{console.log("failed database insert",s)})}).catch(i=>console.error("Could not subscribe to notifications",i))})()}addPushSubscriber(t){var i=this;return(0,l.Z)(function*(){console.log("endpoint",t.endpoint),console.log("adding this to database",t);const s=yield i.supabaseClient.rpc("insert_into_push_notifications",{endpoint_in:t.endpoint,expiration_time_in:t.expirationTime,p256dh_in:t.p256dh,auth_in:t.auth,user_id_in:i.loggedInUserId});if(s.error)throw new Error(s.error.message);return s})()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(ze.Mk),e.Y36(I.c))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-push-notifications"]],decls:2,vars:0,consts:[["styleClass","max-w-90","position","top-right"],["data-cy","subscribeToPushNotifications","pButton","","type","button","label","Request push",3,"click"]],template:function(t,i){1&t&&(e._UZ(0,"p-toast",0),e.TgZ(1,"button",1),e.NdJ("click",function(){return i.subscribeToNotifications()}),e.qZA())},dependencies:[T.Hq,x.FN]}),n})();function Ve(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"p-chip",26),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.setTaskFilter())}),e.qZA()}}function Be(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"p-chip",27),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.setTaskFilter())}),e.qZA()}}function Ke(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"p-chip",28),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.setGroupFilter())}),e.qZA()}}function $e(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"p-chip",29),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.setGroupFilter())}),e.qZA()}}function je(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"p-chip",30),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.setAmendmentFilter())}),e.qZA()}}function We(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"p-chip",31),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.setAmendmentFilter())}),e.qZA()}}function Xe(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"p-chip",32),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.setEventFilter())}),e.qZA()}}function et(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"p-chip",33),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.setEventFilter())}),e.qZA()}}function tt(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"p-chip",34),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.setAccountFilter())}),e.qZA()}}function nt(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"p-chip",35),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.setAccountFilter())}),e.qZA()}}function it(n,r){if(1&n){const t=e.EpF();e.TgZ(0,"div",38),e.NdJ("scrolled",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.loadNewData())}),e._UZ(1,"app-news-list-item",39),e.qZA()}if(2&n){const t=r.$implicit;e.Q6J("infiniteScrollDistance",1)("infiniteScrollUpDistance",1.5)("infiniteScrollThrottle",50),e.xp6(1),e.Q6J("news",t)}}function st(n,r){if(1&n&&(e.TgZ(0,"div",36),e.YNc(1,it,2,4,"div",37),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.newsList.slice(t.paginationData.from,t.paginationData.to))}}const ot=[{path:"",component:Ue,canActivate:[N.u]},{path:"news",component:(()=>{class n{constructor(t,i,s,o){this.messageService=t,this.newsService=i,this.newsQuery=s,this.paginationService=o,this.menuItems=L,this.menuItemsMega=D,this.newsList=[],this.taskFilterOn=!1,this.amendmentFilterOn=!1,this.eventFilterOn=!1,this.groupFilterOn=!1,this.accountFilterOn=!1,this.paginationData={from:0,to:4,canLoad:!0,reloadDelay:2e3,sizeOfNewLoad:10,numberOfSearchResults:0},this.errorMessage="",this.error=!1,this.loadingInitial=!1}ngOnInit(){this.loadInitialData(),this.newsService.resetUnreadNotificationsCounter()}ngOnDestroy(){var t=this;return(0,l.Z)(function*(){t.newsSubscription&&t.newsSubscription.unsubscribe(),t.newsUsersFilterSubscription&&t.newsUsersFilterSubscription.unsubscribe(),t.newsRealTimeSubscription&&t.newsRealTimeSubscription.unsubscribe(),t.newsGroupsFilterSubscription&&t.newsGroupsFilterSubscription.unsubscribe();try{console.log("onDestroy"),yield t.newsService.resetNotificationsCounter(),yield t.newsService.markNotificationsAsUnread(),yield t.newsService.markNotificationsAsUnreadFromGroup(),yield t.newsService.set_non_existing_groups_set_notifications_to_false()}catch{t.messageService.add({severity:"success",summary:"success"})}})()}loadNewData(){this.paginationData=this.paginationService.scrollDownAndLoadAscending(this.paginationData)}onSearch(t){}setTaskFilter(){this.taskFilterOn=!this.taskFilterOn}setAmendmentFilter(){this.amendmentFilterOn=!this.amendmentFilterOn}setEventFilter(){this.eventFilterOn=!this.eventFilterOn}setGroupFilter(){this.groupFilterOn=!this.groupFilterOn,this.groupFilterOn?this.newsGroupsFilterSubscription=this.newsQuery.filterNewsByType("groups").subscribe(t=>{this.newsList=t,this.paginationData.numberOfSearchResults=this.newsList.length}):this.subscribeAllNews()}setAccountFilter(){this.accountFilterOn=!this.accountFilterOn,this.accountFilterOn?this.newsUsersFilterSubscription=this.newsQuery.filterNewsByType("account").subscribe(t=>{this.newsList=t,this.paginationData.numberOfSearchResults=this.newsList.length}):this.subscribeAllNews()}subscribeAllNews(){this.newsSubscription=this.newsQuery.allNews$.subscribe(t=>{this.newsList=t,this.paginationData.numberOfSearchResults=this.newsList.length,console.log("loaded news"),console.log(this.newsList)})}loadInitialData(){var t=this;return(0,l.Z)(function*(){t.newsService.resetUnreadNotificationsCounter();try{t.loadingInitial=!0,t.error=!1,t.newsRealTimeSubscription=t.newsService.getRealTimeChangesNews(),yield t.newsService.getAllNotifications(),t.subscribeAllNews(),t.messageService.add({severity:"success",summary:"success"})}catch(i){t.error=!0,t.errorMessage=i.message,t.messageService.add({severity:"error",summary:i.message})}finally{t.loadingInitial=!1}})()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(m.ez),e.Y36(Re.Y),e.Y36(h),e.Y36(A.a))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-news"]],features:[e._Bn([m.ez])],decls:31,vars:19,consts:[["styleClass","max-w-90","position","top-right"],[3,"specialOrStandart","megaMenuItemStandart"],["slot","main"],[1,"mb-8"],[3,"submit"],[1,"grid"],[1,"col-12"],[1,"p-float-label"],["id","float-input","type","text","pInputText","",1,"w-full","p-inputtext",3,"value"],["searchBar",""],["for","float-input"],[1,"w-full","text-center"],["label","TASKS","styleClass","mr-1 mb-1 cursor-pointer accent-container",3,"click",4,"ngIf"],["label","TASKS","styleClass","mr-1 mb-1 cursor-pointer",3,"click",4,"ngIf"],["label","GROUP","styleClass","mr-1 mb-1 cursor-pointer accent-container",3,"click",4,"ngIf"],["label","GROUP","styleClass","mr-1 mb-1 cursor-pointer",3,"click",4,"ngIf"],["label","AMENDMENTS","styleClass","mr-1 mb-1 cursor-pointer accent-container",3,"click",4,"ngIf"],["label","AMENDMENTS","styleClass","mr-1 mb-1 cursor-pointer",3,"click",4,"ngIf"],["label","EVENT","styleClass","mr-1 mb-1 cursor-pointer accent-container",3,"click",4,"ngIf"],["label","EVENT","styleClass","mr-1 mb-1 cursor-pointer",3,"click",4,"ngIf"],["label","ACCOUNT","styleClass","mr-1 mb-1  cursor-pointer accent-container",3,"click",4,"ngIf"],["label","ACCOUNT","styleClass","mr-1 mb-1 cursor-pointer",3,"click",4,"ngIf"],[3,"error","loading","errorMessage","retryAction"],["data-cy","newsContainer",4,"ngIf"],["slot","side"],[3,"specialOrStandart","menuItemsStandart"],["label","TASKS","styleClass","mr-1 mb-1 cursor-pointer accent-container",3,"click"],["label","TASKS","styleClass","mr-1 mb-1 cursor-pointer",3,"click"],["label","GROUP","styleClass","mr-1 mb-1 cursor-pointer accent-container",3,"click"],["label","GROUP","styleClass","mr-1 mb-1 cursor-pointer",3,"click"],["label","AMENDMENTS","styleClass","mr-1 mb-1 cursor-pointer accent-container",3,"click"],["label","AMENDMENTS","styleClass","mr-1 mb-1 cursor-pointer",3,"click"],["label","EVENT","styleClass","mr-1 mb-1 cursor-pointer accent-container",3,"click"],["label","EVENT","styleClass","mr-1 mb-1 cursor-pointer",3,"click"],["label","ACCOUNT","styleClass","mr-1 mb-1  cursor-pointer accent-container",3,"click"],["label","ACCOUNT","styleClass","mr-1 mb-1 cursor-pointer",3,"click"],["data-cy","newsContainer"],["infiniteScroll","",3,"infiniteScrollDistance","infiniteScrollUpDistance","infiniteScrollThrottle","scrolled",4,"ngFor","ngForOf"],["infiniteScroll","",3,"infiniteScrollDistance","infiniteScrollUpDistance","infiniteScrollThrottle","scrolled"],[3,"news"]],template:function(t,i){if(1&t){const s=e.EpF();e.TgZ(0,"p-toast",0),e._uU(1,">"),e.qZA(),e._UZ(2,"app-menu-bar-secondary-top",1),e.TgZ(3,"app-wrapper-grid")(4,"div",2)(5,"div",3)(6,"form",4),e.NdJ("submit",function(){e.CHM(s);const c=e.MAs(11);return e.KtG(i.onSearch(c.value))}),e.TgZ(7,"div",5)(8,"div",6)(9,"span",7),e._UZ(10,"input",8,9),e.TgZ(12,"label",10),e._uU(13,"Search"),e.qZA()()()()(),e.TgZ(14,"div",11),e._UZ(15,"app-push-notifications"),e.qZA(),e.TgZ(16,"div",11),e.YNc(17,Ve,1,0,"p-chip",12),e.YNc(18,Be,1,0,"p-chip",13),e.YNc(19,Ke,1,0,"p-chip",14),e.YNc(20,$e,1,0,"p-chip",15),e.YNc(21,je,1,0,"p-chip",16),e.YNc(22,We,1,0,"p-chip",17),e.YNc(23,Xe,1,0,"p-chip",18),e.YNc(24,et,1,0,"p-chip",19),e.YNc(25,tt,1,0,"p-chip",20),e.YNc(26,nt,1,0,"p-chip",21),e.qZA(),e.TgZ(27,"app-loading-spinner",22),e.NdJ("retryAction",function(){return i.loadInitialData()}),e.qZA(),e.YNc(28,st,2,1,"div",23),e.qZA()(),e.TgZ(29,"div",24),e._UZ(30,"app-menu-bar-secondary-right",25),e.qZA()()}2&t&&(e.xp6(2),e.Q6J("specialOrStandart",!1)("megaMenuItemStandart",i.menuItemsMega),e.xp6(8),e.Q6J("value",""),e.xp6(7),e.Q6J("ngIf",i.taskFilterOn),e.xp6(1),e.Q6J("ngIf",!i.taskFilterOn),e.xp6(1),e.Q6J("ngIf",i.groupFilterOn),e.xp6(1),e.Q6J("ngIf",!i.groupFilterOn),e.xp6(1),e.Q6J("ngIf",i.amendmentFilterOn),e.xp6(1),e.Q6J("ngIf",!i.amendmentFilterOn),e.xp6(1),e.Q6J("ngIf",i.eventFilterOn),e.xp6(1),e.Q6J("ngIf",!i.eventFilterOn),e.xp6(1),e.Q6J("ngIf",i.accountFilterOn),e.xp6(1),e.Q6J("ngIf",!i.accountFilterOn),e.xp6(1),e.Q6J("error",i.error)("loading",i.loadingInitial)("errorMessage",i.errorMessage),e.xp6(1),e.Q6J("ngIf",!i.loadingInitial&&!i.error),e.xp6(2),e.Q6J("specialOrStandart",!1)("menuItemsStandart",i.menuItems))},dependencies:[p.sg,p.O5,S.A,M.V,E.U,P.e,Ge,x.FN,C.Ry,Y.g,He],styles:[".test[_ngcontent-%COMP%]{width:300px;height:300px}"]}),n})(),canActivate:[N.u]},{path:":id",component:be,canActivate:[N.u]}];let at=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[f.Bz.forChild(ot),f.Bz]}),n})();var z=a(5480),R=a(3943),H=a(5604);let ct=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[p.ez,_.F,G.W]}),n})();var V=a(6609);let lt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[p.ez,T.hJ,x.EV]}),n})(),pt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[p.ez,S.o,z.x,R.q,H.Q,R.q,ct,x.EV,C.Rq,V.z,lt]}),n})();var ut=a(989);let mt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[p.ez]}),n})(),dt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[p.ez,q.TX,_.F]}),n})();var B=a(3718);let Ct=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[p.ez,m.m8,B.v,m.m8,B.v]}),n})(),yt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[p.ez,at,u.u5,S.o,_.F,O.j,T.hJ,z.x,H.Q,R.q,pt,ut.n,mt,dt,V.z,Ct,C.Rq]}),n})()}}]);