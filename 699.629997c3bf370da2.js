"use strict";(self.webpackChunkpolity=self.webpackChunkpolity||[]).push([[699],{699:(Tt,R,a)=>{a.r(R),a.d(R,{ChatModule:()=>vt});var p=a(6895),h=a(8996),T=a(9028),l=a(5861),f=a(805),e=a(4650),y=a(5813),g=a(2340),w=a(6923);let K=(()=>{class i{constructor(t){this.authentificationQuery=t,this.supabaseClient=(0,y.eI)(g.N.supabaseUrl,g.N.supabaseKey),this.authSubscription=this.authentificationQuery.uuid$.subscribe(n=>{this.loggedInID=n})}ngOnDestroy(){this.authSubscription&&this.authSubscription.unsubscribe()}resetNumberOfUnreadMessages(t,n){var r=this;return(0,l.Z)(function*(){const o=yield r.supabaseClient.rpc("reset_number_of_unread_messages",{room_id_in:t,user_id_of_reader:n});if(o.error)throw new Error(o.error.message);return o})()}resetNumberOfUnreadMessagesOfGroup(t,n){var r=this;return(0,l.Z)(function*(){const o=yield r.supabaseClient.rpc("reset_number_of_unread_messages_in_group",{group_id_in:t,user_id_of_reader:n});if(o.error)throw new Error(o.error.message);return o})()}sendMessage(t,n,r,o,c){var m=this;return(0,l.Z)(function*(){console.log("called");let _="";m.loggedInID&&(_=m.loggedInID);const d=yield m.supabaseClient.rpc("send_message_transaction",{room_id_in:t,message_sender:_,message_receiver:n,content_in:r,is_group:o,group_id_in:c});if(d.error)throw new Error(d.error.message);return console.log("ended no error"),d})()}checkIfChatPartnerAcceptedRequest(t,n){var r=this;return(0,l.Z)(function*(){const o=yield r.supabaseClient.from("rooms_participants").select("accepted").eq("room_id",t).eq("user_id",n).single();if(o.error)throw new Error(o.error.message);return o})()}acceptChatRequest(t,n){var r=this;return(0,l.Z)(function*(){const o=yield r.supabaseClient.rpc("accept_chat_request",{room_id_in:t,user_id_of_reader:n});if(o.error)throw new Error(o.error.message);return o})()}getChatPartner(t){var n=this;return(0,l.Z)(function*(){let r="";n.loggedInID&&(r=n.loggedInID);const o=yield n.supabaseClient.rpc("select_chat_partner",{message_sender:r,room_id_in:t});if(o.error)throw new Error(o.error.message);return o})()}rejectChatRequest(t,n,r){var o=this;return(0,l.Z)(function*(){const c=yield o.supabaseClient.rpc("reject_chat_request_transaction",{room_id_in:t,follower_id:n,following_id:r});if(c.error)throw new Error(c.error.message);return c})()}getGroupAsChatPartner(t){var n=this;return(0,l.Z)(function*(){const r=yield n.supabaseClient.rpc("select_group_as_chat_partner",{room_id_in:t});if(r.error)throw new Error(r.error.message);return r})()}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(w.c))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var F=a(19),x=a(7607);let M=(()=>{class i extends F.AE{constructor(t){super(t),this.store=t,this.messages$=this.select(n=>n.messages)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(x.n))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var $=a(7579);let j=(()=>{class i{constructor(t,n){this.chatRoomStore=t,this.chatRoomQuery=n,this.newMessageOfUserNotifier=new $.x,this.supabaseClient=(0,y.eI)(g.N.supabaseUrl,g.N.supabaseKey)}getAllMessagesOfChat(t,n,r){var o=this;return(0,l.Z)(function*(){const c=yield o.supabaseClient.rpc("select_all_messages_of_room",{room_id_in:t}).order("created_at_in",{ascending:!1});if(c.data&&o.chatRoomStore.update({messages:c.data}),c.error)throw new Error(c.error.message);return c})()}getRealTimeChangesMessages(t){return this.supabaseClient.from(`rooms_messages:room_id=eq.${t}`).on("INSERT",r=>{const o={message_id:r.new.message_id,created_at_in:r.new.created_at,sender_id:r.new.user_id,content_in:r.new.content};this.chatRoomStore.update(c=>{let m=c.messages;m.push(o),c.messages=m}),this.newMessageOfUserNotifier.next(o.sender_id)}).subscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(x.n),e.LFG(M))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var U=a(5754),W=a(4143),X=a(9466),ee=a(2545),N=a(9496),u=a(433),v=a(8271),Z=a(1740),b=a(5593),A=a(8092),te=a(9469);function ie(i,s){if(1&i&&(e.TgZ(0,"h4",5),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.message.sender_id)}}const ne=function(i){return{"flex flex-row-reverse":i}},re=function(i,s){return{"primary-container":i," neutral-90":s}};let se=(()=>{class i{constructor(){this.showSender=!1,this.loggedInUserId="",this.messageOfLoggedInUser=!1}ngOnInit(){this.checkIfMessageFromLoggedInUser()}checkIfMessageFromLoggedInUser(){this.loggedInUserId===this.message.sender_id&&(this.messageOfLoggedInUser=!0)}}return i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-message"]],inputs:{message:"message",showSender:"showSender",loggedInUserId:"loggedInUserId"},decls:8,vars:13,consts:[[3,"ngClass"],[1,"w-9","p-4","border-round","mb-2",3,"ngClass"],["class","my-0 on-light-surface-in-dark-theme",4,"ngIf"],[1,"mt-1","on-light-surface-in-dark-theme"],[1,"w-full","mb-0","text-right","on-light-surface-in-dark-theme"],[1,"my-0","on-light-surface-in-dark-theme"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,ie,2,1,"h4",2),e.TgZ(3,"p",3),e._uU(4),e.qZA(),e.TgZ(5,"p",4),e._uU(6),e.ALo(7,"date"),e.qZA()()()),2&t&&(e.Q6J("ngClass",e.VKq(8,ne,n.messageOfLoggedInUser)),e.xp6(1),e.Q6J("ngClass",e.WLB(10,re,n.messageOfLoggedInUser,!n.messageOfLoggedInUser)),e.xp6(1),e.Q6J("ngIf",n.showSender),e.xp6(2),e.Oqu(n.message.content_in),e.xp6(2),e.Oqu(e.xi3(7,5,n.message.created_at_in,"HH:mm:ss")))},dependencies:[p.mk,p.O5,p.uU]}),i})();var C=a(7296);const oe=["hello"],ae=["test1"],ce=["messages"];function le(i,s){if(1&i&&(e.TgZ(0,"p",21),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.MGl("routerLink","/profile/",t.profile.id,""),e.xp6(1),e.Oqu(t.profile.name)}}function pe(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",15)(1,"div",16),e.YNc(2,le,2,2,"p",17),e.TgZ(3,"a",18),e._UZ(4,"p-avatar",19),e.qZA()(),e.TgZ(5,"i",20),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.rejectRequest())}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.profile),e.xp6(1),e.MGl("routerLink","/profile/",t.profile.id,""),e.xp6(1),e.s9C("image",t.profile.avatar_url)}}function ue(i,s){if(1&i&&(e.TgZ(0,"p",23),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Oqu(t.group.name)}}function me(i,s){if(1&i&&(e.TgZ(0,"div",15)(1,"div",16),e.YNc(2,ue,2,1,"p",22),e.TgZ(3,"a",18),e._UZ(4,"p-avatar",19),e.qZA()()()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.group),e.xp6(1),e.MGl("routerLink","/groups/",t.group.id,""),e.xp6(1),e.s9C("image",t.group.avatar_url)}}function de(i,s){1&i&&(e.TgZ(0,"div")(1,"p",25),e._uU(2,"Ihr habt euch noch keine Nachrichten geschrieben."),e.qZA()())}function he(i,s){if(1&i&&(e.TgZ(0,"div"),e._UZ(1,"app-message",30),e.qZA()),2&i){const t=s.$implicit,n=e.oxw(4);e.xp6(1),e.Q6J("message",t)("loggedInUserId",n.loggedInUserId)}}function ge(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",26,27),e.NdJ("scrolledUp",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.onScrollUp())})("scrolled",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.onScrollDown())}),e.YNc(2,he,2,2,"div",28),e.TgZ(3,"div",null,29),e._uU(5,"last element"),e.qZA()()}if(2&i){const t=e.oxw(3);e.Q6J("infiniteScrollDistance",1)("infiniteScrollUpDistance",1.5)("infiniteScrollThrottle",50),e.xp6(2),e.Q6J("ngForOf",t.messagesOfChat.slice(t.paginationData.from,t.paginationData.to))}}function fe(i,s){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,de,3,0,"div",7),e.YNc(2,ge,6,4,"div",24),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",0===t.messagesOfChat.length),e.xp6(1),e.Q6J("ngIf",t.messagesOfChat.length>0)}}function _e(i,s){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,fe,3,2,"div",7),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.messagesOfChat)}}function ve(i,s){1&i&&(e.TgZ(0,"div")(1,"p",25),e._uU(2,"Deine Anfrage wurde noch nicht akzeptiert."),e.qZA()())}function Ce(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"div",25)(2,"div",31)(3,"p"),e._uU(4,"Du hast eine neue Chat-Anfrage. Wie m\xf6chtest du reagieren?"),e.qZA(),e.TgZ(5,"div",32)(6,"button",33),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.acceptRequestAndFollow())}),e.qZA()(),e.TgZ(7,"div",32)(8,"button",34),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.acceptRequest())}),e.qZA()(),e.TgZ(9,"div",32)(10,"button",35),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.rejectRequest())}),e.qZA()()()()()}}let ye=(()=>{class i{constructor(t,n,r,o,c,m,_,d,Ct,yt,wt,bt,It,St){this.chatService=t,this.chatRoomQuery=n,this.chatRoomService=r,this.authentificationQuery=o,this.route=c,this.profileService=m,this.profileQuery=_,this.followingService=d,this.groupsService=Ct,this.router=yt,this.messageService=wt,this.chatRoomStore=bt,this.renderer=It,this.paginationService=St,this.name="",this.avatarUrl="",this.message="",this.selectedRoomId="",this.loggedInUserId="",this.messagesOfChat=[],this.isGroup=!1,this.chatPartner="",this.testBoolean=!0,this.chatPartnerAcceptedRequest=!0,this.loggedInUserAcceptedRequest=!0,this.enquirer=!1,this.scrolledDown=!0,this.loadingInitial=!1,this.error=!1,this.checkView=!0,this.paginationData={from:0,to:10,canLoad:!0,reloadDelay:2e3,sizeOfNewLoad:10,numberOfSearchResults:0}}ngOnInit(){this.getSelectedId(),this.getLoggedInUserId(),this.scrollNotifierSubscription=this.chatRoomService.newMessageOfUserNotifier.subscribe(t=>{this.checkView=!0,console.log("Please scroll"),console.log("Please reset counter"),console.log("in my prop"),console.log("sender_id"),console.log(t),console.log("logged in"),console.log(this.loggedInUserId),this.paginationData.to=this.paginationData.to+1,t!==this.loggedInUserId&&(console.log("reset because other id"),this.resetUnreadMessageCounterWhileChatOpen())}),this.getChatPartner(),this.loadInitialData(),this.MyProp||console.log("undefined")}ngAfterViewChecked(){console.log(window.scrollY),console.log(this.paginationData.from),console.log(this.paginationData.to),this.testBoolean&&(console.log("called"),console.log(this.testBoolean),this.testBoolean=!0,this.MyProp1&&this.checkView&&this.renderer.selectRootElement(this.MyProp1.nativeElement).scrollIntoView())}ngOnDestroy(){this.authSubscription&&this.authSubscription.unsubscribe(),this.profileSubscription&&this.profileSubscription.unsubscribe(),this.messageRealtimeSubscription&&this.messageRealtimeSubscription.unsubscribe(),this.messageSubscription&&this.messageSubscription.unsubscribe(),this.scrollNotifierSubscription&&this.scrollNotifierSubscription.unsubscribe()}resetUnreadMessageCounterWhileChatOpen(){var t=this;return(0,l.Z)(function*(){try{t.loggedInUserId&&(yield t.chatService.resetNumberOfUnreadMessages(t.selectedRoomId,t.chatPartner))}catch(n){t.messageService.add({severity:"error",summary:n.message})}})()}loadInitialData(){var t=this;return(0,l.Z)(function*(){try{t.loadingInitial=!0,t.error=!1,yield t.chatRoomService.getAllMessagesOfChat(t.selectedRoomId,t.paginationData.from,t.paginationData.to),t.messageSubscription=t.chatRoomQuery.messages$.subscribe(n=>{t.messagesOfChat=n.reverse(),t.paginationData.from=t.messagesOfChat.length-10,t.paginationData.to=t.messagesOfChat.length,console.log("initial"),console.log(t.paginationData.from),console.log(t.paginationData.to),t.MyProp||console.log("undefined")}),t.messageRealtimeSubscription=t.chatRoomService.getRealTimeChangesMessages(t.selectedRoomId)}catch(n){t.error=!0,t.errorMessage=n.message,t.messageService.add({severity:"error",summary:n.message})}finally{t.loadingInitial=!1,console.log("called finally"),t.MyProp1?(console.log("found in finally"),t.renderer.selectRootElement(t.MyProp1.nativeElement).scrollIntoView()):console.log("undefined")}})()}onScrollDown(){console.log("scrolled down!!"),this.loadNewData()}onScrollUp(){console.log("scrolled up!!"),this.loadNewData(),console.log("from")}loadNewData(){this.checkView=!1,this.paginationData=this.paginationService.scrollUpAndLoadDescending(this.paginationData)}getSelectedId(){this.route.paramMap.subscribe(t=>{this.selectedRoomId=String(t.get("id"))})}onSendMessage(){var t=this;return(0,l.Z)(function*(){let n;n=t.group?t.group.id:void 0;try{yield t.chatService.sendMessage(t.selectedRoomId,t.chatPartner,t.message,t.isGroup,n),t.message=""}catch(r){t.messageService.add({severity:"error",summary:r.message})}finally{console.log("finnaly message send"),t.MyProp1&&console.log("in my prop")}})()}getLoggedInUserId(){this.authSubscription=this.authentificationQuery.uuid$.subscribe(t=>{this.loggedInUserId=t})}getProfile(){this.profileService.upsert(this.chatPartner),this.profileSubscription=this.profileQuery.selectEntity(this.chatPartner).subscribe(t=>{t&&(this.profile=t)})}getGroup(){var t=this;return(0,l.Z)(function*(){try{const n=yield t.groupsService.selectGroup(t.chatPartner);t.group=n.data}catch(n){t.messageService.add({severity:"error",summary:n.message})}})()}getChatPartner(){var t=this;return(0,l.Z)(function*(){try{const n=yield t.chatService.getChatPartner(t.selectedRoomId);if(t.chatPartner=n.data,t.chatPartner){t.isGroup=!1,t.getProfile();try{t.loggedInUserId&&t.chatService.resetNumberOfUnreadMessages(t.selectedRoomId,t.chatPartner)}catch(r){t.messageService.add({severity:"error",summary:r.message})}}else try{t.isGroup=!0;const r=yield t.chatService.getGroupAsChatPartner(t.selectedRoomId);t.chatPartner=r.data,t.getGroup()}catch(r){t.messageService.add({severity:"error",summary:r.message})}t.checkIfChatPartnerAcceptedRequest(),t.checkIfChatLoggedInUserAcceptedRequest()}catch(n){t.messageService.add({severity:"error",summary:n.message})}})()}checkIfChatPartnerAcceptedRequest(){var t=this;return(0,l.Z)(function*(){try{const n=yield t.chatService.checkIfChatPartnerAcceptedRequest(t.selectedRoomId,t.chatPartner);t.chatPartnerAcceptedRequest=n.data.accepted}catch(n){t.messageService.add({severity:"error",summary:n.message})}})()}checkIfChatLoggedInUserAcceptedRequest(){var t=this;return(0,l.Z)(function*(){try{if(t.loggedInUserId){const n=yield t.chatService.checkIfChatPartnerAcceptedRequest(t.selectedRoomId,t.loggedInUserId);t.loggedInUserAcceptedRequest=n.data.accepted}}catch(n){t.messageService.add({severity:"error",summary:n.message})}})()}acceptRequestAndFollow(){var t=this;return(0,l.Z)(function*(){try{yield t.followingService.followTransaction(t.chatPartner),t.loggedInUserAcceptedRequest=!0}catch(n){t.messageService.add({severity:"error",summary:n.message})}})()}acceptRequest(){var t=this;return(0,l.Z)(function*(){try{t.loggedInUserId&&(yield t.chatService.acceptChatRequest(t.selectedRoomId,t.loggedInUserId),t.loggedInUserAcceptedRequest=!0)}catch(n){t.messageService.add({severity:"error",summary:n.message})}})()}rejectRequest(){var t=this;return(0,l.Z)(function*(){try{t.loggedInUserId&&(yield t.chatService.rejectChatRequest(t.selectedRoomId,t.chatPartner,t.loggedInUserId),t.loggedInUserAcceptedRequest=!1,t.router.navigate(["/orga"]))}catch(n){t.messageService.add({severity:"error",summary:n.message})}})()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(K),e.Y36(M),e.Y36(j),e.Y36(w.c),e.Y36(h.gz),e.Y36(U.H),e.Y36(W.w),e.Y36(X.J),e.Y36(ee.J),e.Y36(h.F0),e.Y36(f.ez),e.Y36(x.n),e.Y36(e.Qsj),e.Y36(N.a))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-chat-room"]],viewQuery:function(t,n){if(1&t&&(e.Gf(oe,5),e.Gf(ae,5),e.Gf(ce,5)),2&t){let r;e.iGM(r=e.CRH())&&(n.MyProp=r.first),e.iGM(r=e.CRH())&&(n.MyProp1=r.first),e.iGM(r=e.CRH())&&(n.content=r.first)}},inputs:{name:"name",avatarUrl:"avatarUrl"},features:[e._Bn([f.ez])],decls:19,vars:10,consts:[[1,"fixed","w-full","top-fixed","surface"],[1,"flex"],["data-cy","backButton",1,"",3,"title","link"],["class","flex align-items-center w-full",4,"ngIf"],[3,"noTopBar"],["slot","main"],[1,"mb-8"],[4,"ngIf"],["slot","side"],[1,"fixed","w-full","p-3","bottom-fixed","left-0","background-color"],[3,"ngSubmit"],["messageForm","ngForm"],[1,"p-float-label"],["data-cy","send-message","name","message","id","message","type","text","pInputText","",1,"w-full","p-inputtext",3,"ngModel","disabled","ngModelChange"],["for","message"],[1,"flex","align-items-center","w-full"],[1,"w-full","flex","justify-content-end"],["class","flex align-items-center cursor-pointer",3,"routerLink",4,"ngIf"],[1,"flex","align-items-center","ml-5","mr-5","cursor-pointer",3,"routerLink"],["shape","circle","styleClass","border-round",1,"border-round","flex","align-items-center","justify-content-center",3,"image"],["data-cy","delete-chat",1,"cursor-pointer","pi","pi-times","align-items-center","flex","justify-content-center","mr-4","on-dark-surface-in-dark-theme",3,"click"],[1,"flex","align-items-center","cursor-pointer",3,"routerLink"],["class","flex align-items-center",4,"ngIf"],[1,"flex","align-items-center"],["class","search-results mt-8 margin-bottom","infiniteScroll","",3,"infiniteScrollDistance","infiniteScrollUpDistance","infiniteScrollThrottle","scrolledUp","scrolled",4,"ngIf"],[1,"text-center","margin-mid"],["infiniteScroll","",1,"search-results","mt-8","margin-bottom",3,"infiniteScrollDistance","infiniteScrollUpDistance","infiniteScrollThrottle","scrolledUp","scrolled"],["messages",""],[4,"ngFor","ngForOf"],["test1",""],[3,"message","loggedInUserId"],[1,"flex","flex-column"],[1,"flex","justify-content-center"],["pButton","","type","button","label","Akzeptieren & Folgen",1,"fit-content","p-button-raised",3,"click"],["pButton","","type","button","label","Nur akzeptieren",1,"fit-content","p-button-text",3,"click"],["pButton","","type","button","label","Ablehnen",1,"fit-content","p-button-text","p-button-danger",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"app-back-button",2),e.YNc(3,pe,6,3,"div",3),e.YNc(4,me,5,3,"div",3),e.qZA()(),e.TgZ(5,"app-wrapper-grid",4)(6,"div",5)(7,"div",6),e.YNc(8,_e,2,1,"div",7),e.YNc(9,ve,3,0,"div",7),e.YNc(10,Ce,11,0,"div",7),e.qZA()(),e._UZ(11,"div",8),e.qZA(),e.TgZ(12,"div",9)(13,"form",10,11),e.NdJ("ngSubmit",function(){return n.onSendMessage()}),e.TgZ(15,"span",12)(16,"input",13),e.NdJ("ngModelChange",function(o){return n.message=o}),e.qZA(),e.TgZ(17,"label",14),e._uU(18,"Neue Nachricht"),e.qZA()()()()),2&t&&(e.xp6(2),e.Q6J("title","Zur\xfcck")("link","/orga"),e.xp6(1),e.Q6J("ngIf",n.profile),e.xp6(1),e.Q6J("ngIf",n.group),e.xp6(1),e.Q6J("noTopBar",!0),e.xp6(3),e.Q6J("ngIf",n.loggedInUserAcceptedRequest&&n.chatPartnerAcceptedRequest),e.xp6(1),e.Q6J("ngIf",n.loggedInUserAcceptedRequest&&!n.chatPartnerAcceptedRequest),e.xp6(1),e.Q6J("ngIf",!n.loggedInUserAcceptedRequest&&n.chatPartnerAcceptedRequest),e.xp6(6),e.Q6J("ngModel",n.message)("disabled",!n.chatPartnerAcceptedRequest||!n.loggedInUserAcceptedRequest))},dependencies:[p.sg,p.O5,h.rH,h.yS,u._Y,u.Fj,u.JJ,u.JL,u.On,u.F,v.q,Z.o,b.Hq,A.V,te.W,se,C.Ry],styles:[".bottom-fixed[_ngcontent-%COMP%]{bottom:4rem}.top-fixed[_ngcontent-%COMP%]{left:0rem;top:0rem;padding-left:2rem}.margin-mid[_ngcontent-%COMP%]{margin-top:40vh}.margin-bottom[_ngcontent-%COMP%]{margin-bottom:10rem}@media only screen and (min-width: 1024px){.bottom-fixed[_ngcontent-%COMP%]{padding-left:15rem!important;padding-right:5rem!important;bottom:0rem!important}.top-fixed[_ngcontent-%COMP%]{padding-left:16rem;padding-right:16rem}.margin-bottom[_ngcontent-%COMP%]{margin-bottom:10rem!important}}"]}),i})();const k=[{label:"CHAT",routerLink:["/orga"],routerLinkActiveOptions:{exact:!0},id:"chat-cy"},{label:"NEWS",routerLink:["/orga/news"],routerLinkActiveOptions:{exact:!0},id:"news-cy"}],J=[{icon:"pi pi-fw pi-comments",routerLink:["/orga"],routerLinkActiveOptions:{exact:!0},id:"chat-cy-mob"},{icon:"pi pi-fw pi-bell",routerLink:["/orga/news"],routerLinkActiveOptions:{exact:!0},id:"news-cy-mob"}];var P=a(4004),D=a(6943);let Q=(()=>{class i extends F.Gv{constructor(t){super(t),this.store=t,this.allChats$=this.selectAll()}filterData(t,n){let r=this.allChats$;return n&&(r=r.pipe((0,P.U)(o=>o.filter(c=>!0===c.is_group)))),""!==t&&(r=r.pipe((0,P.U)(o=>o.filter(c=>c.name.includes(t))))),r}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(D.w))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})(),we=(()=>{class i{constructor(t,n,r){this.chatQuery=t,this.authentificationQuery=n,this.chatStore=r,this.supabaseClient=(0,y.eI)(g.N.supabaseUrl,g.N.supabaseKey)}ngOnDestroy(){this.authSubscription&&this.authSubscription.unsubscribe(),this.authSubscription2&&this.authSubscription2.unsubscribe(),this.authSubscription&&this.authSubscription.unsubscribe()}selectAllRoomsOfUser(){var t=this;return(0,l.Z)(function*(){let n="";t.authSubscription=t.authentificationQuery.uuid$.subscribe(o=>{n=o});const r=yield t.supabaseClient.rpc("select_all_rooms_of_user",{user_id_in:n});if(r.data){const o=r.data;t.chatStore.reset(),t.chatStore.add(o)}if(r.error)throw new Error(r.error.message);return r})()}add(t){this.chatStore.add(t)}update(t,n){this.chatStore.update(t,n)}remove(t){this.chatStore.remove(t)}getRealTimeChangesOnNewFollow(){let t="";return this.authSubscription2=this.authentificationQuery.uuid$.subscribe(r=>{t=r}),this.supabaseClient.from(`following_profile_system:following=eq.${t}`).on("INSERT",r=>{console.log(),console.log(r),this.selectAllRoomsOfUser()}).subscribe()}getRealTimeChanges(){this.chatQuery.allChats$.subscribe(t=>{t.forEach(n=>{let r=n.id;return this.supabaseClient.from(`rooms:id=eq.${r}`).on("UPDATE",c=>{this.chatStore.update(r,{last_message:c.new.last_message,last_message_time:c.new.last_message_time})}).on("INSERT",c=>{console.log("INSERT"),console.log("payload"),console.log(c)}).on("DELETE",c=>{console.log("DELETE"),console.log("Payload"),console.log(c),this.chatStore.remove(c.old.id)}).subscribe()}),t.forEach(n=>{let r=n.id;return this.supabaseClient.from(`rooms_participants:room_id=eq.${r}`).on("UPDATE",c=>{this.chatStore.update(r,{number_of_unread_messages:c.new.number_of_unread_messages})}).subscribe()})})}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(Q),e.LFG(w.c),e.LFG(D.w))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var I=a(7147),L=a(4479),q=a(4524),E=a(8639);function be(i,s){1&i&&e._UZ(0,"i",14)}function Ie(i,s){if(1&i&&e._UZ(0,"p-badge",15),2&i){const t=e.oxw();e.Q6J("value",t.unreadMessagesAsString)}}function Se(i,s){if(1&i&&(e.TgZ(0,"p",16),e._uU(1),e.ALo(2,"date"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,1,t.chat.last_message_time))}}function Te(i,s){if(1&i&&(e.TgZ(0,"p",16),e._uU(1),e.ALo(2,"date"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(e.xi3(2,1,t.chat.last_message_time,"HH:mm:ss"))}}let xe=(()=>{class i{constructor(t){this.router=t,this.showTime=!1,this.unreadMessagesAsString=""}ngOnInit(){this.checkIfMessageReceivedToday(),this.convertNumberToString()}openProfile(t){this.router.navigate([`profile/${this.chat.participant_id}`])}openChat(){this.router.navigate([`orga/${this.chat.id}`])}checkIfMessageReceivedToday(){(new Date).setHours(0,0,0,0)===new Date(this.chat.last_message_time).setHours(0,0,0,0)&&(this.showTime=!0)}convertNumberToString(){this.unreadMessagesAsString=this.chat.number_of_unread_messages.toString()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h.F0))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-chat-list-item"]],inputs:{chat:"chat"},decls:19,vars:7,consts:[[1,"flex","w-full"],[1,"flex-space-arround","p-2","w-full"],[1,"flex","align-items-center","w-full"],[1,"flex-none","mr-5","cursor-pointer",3,"click"],["shape","circle","styleClass","border-round",3,"image"],[1,"flex-grow-1","mr-5","cursor-pointer",3,"click"],[1,"my-0"],[1,"mt-1","mb-0"],[1,"flex-none","p-2","cursor-pointer",3,"click"],[1,"flex-space-between"],[1,"text-center"],["class","pi pi-users mr-2",4,"ngIf"],["data-cy","number-of-unread-messages",3,"value",4,"ngIf"],["class","mb-0",4,"ngIf"],[1,"pi","pi-users","mr-2"],["data-cy","number-of-unread-messages",3,"value"],[1,"mb-0"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3),e.NdJ("click",function(){return n.openProfile("id")}),e._UZ(4,"p-avatar",4),e.qZA(),e.TgZ(5,"a",5),e.NdJ("click",function(){return n.openChat()}),e.TgZ(6,"h4",6),e._uU(7),e.qZA(),e.TgZ(8,"p",7),e._uU(9),e.qZA()(),e.TgZ(10,"a",8),e.NdJ("click",function(){return n.openChat()}),e.TgZ(11,"div",9)(12,"div",10)(13,"div"),e.YNc(14,be,1,0,"i",11),e.YNc(15,Ie,1,1,"p-badge",12),e.qZA(),e.TgZ(16,"div"),e.YNc(17,Se,3,3,"p",13),e.YNc(18,Te,3,4,"p",13),e.qZA()()()()()()()),2&t&&(e.xp6(4),e.s9C("image",n.chat.avatar_url),e.xp6(3),e.Oqu(n.chat.name),e.xp6(2),e.Oqu(n.chat.last_message),e.xp6(5),e.Q6J("ngIf",n.chat.is_group),e.xp6(1),e.Q6J("ngIf",n.chat.number_of_unread_messages>0),e.xp6(2),e.Q6J("ngIf",!n.showTime),e.xp6(1),e.Q6J("ngIf",n.showTime))},dependencies:[p.O5,E.Ct,v.q,p.uU]}),i})();var Y=a(8249);function Ne(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"p-chip",17),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.setGroupFilter())}),e.qZA()}}function Ze(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"p-chip",18),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.setGroupFilter())}),e.qZA()}}function Ae(i,s){if(1&i&&(e.TgZ(0,"div"),e._UZ(1,"app-chat-list-item",21),e.qZA()),2&i){const t=s.$implicit;e.xp6(1),e.Q6J("chat",t)}}function Oe(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",19),e.NdJ("scrolled",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.loadNewData())}),e.YNc(1,Ae,2,1,"div",20),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("infiniteScrollDistance",1)("infiniteScrollUpDistance",1.5)("infiniteScrollThrottle",50),e.xp6(1),e.Q6J("ngForOf",t.chats.slice(t.paginationData.from,t.paginationData.to))}}let Re=(()=>{class i{constructor(t,n,r,o){this.chatQuery=t,this.chatServiceStore=n,this.messageService=r,this.paginationService=o,this.menuItems=k,this.menuItemsMega=J,this.groupFilterOn=!1,this.searchTerm="",this.chats=[],this.loadingInitial=!1,this.error=!1,this.paginationData={from:0,to:4,canLoad:!0,reloadDelay:2e3,sizeOfNewLoad:10,numberOfSearchResults:0}}ngOnInit(){this.loadInitialData(),this.chatSubscription=this.chatQuery.allChats$.subscribe(t=>{t&&(this.chats=t,this.paginationData.numberOfSearchResults=this.chats.length)})}loadInitialData(){var t=this;return(0,l.Z)(function*(){try{t.loadingInitial=!0,t.error=!1,yield t.chatServiceStore.selectAllRoomsOfUser(),t.newFollowerRealTimeChanges=t.chatServiceStore.getRealTimeChangesOnNewFollow(),t.chatRealTimeChanges=t.chatServiceStore.getRealTimeChanges()}catch(n){t.error=!0,t.errorMessage=n.message,t.messageService.add({severity:"error",summary:n.message})}finally{t.loadingInitial=!1}})()}ngOnDestroy(){this.chatRealTimeChanges&&this.chatRealTimeChanges.unsubscribe(),this.newFollowerRealTimeChanges&&this.newFollowerRealTimeChanges.unsubscribe(),this.chatSubscription&&this.chatSubscription.unsubscribe(),this.filterGroupsSubscription&&this.filterGroupsSubscription.unsubscribe(),this.filterNameSubscription&&this.filterNameSubscription.unsubscribe()}loadNewData(){this.paginationData=this.paginationService.scrollDownAndLoadAscending(this.paginationData)}onSearch(t){this.searchTerm=t,this.filterNameSubscription=this.chatQuery.filterData(this.searchTerm,this.groupFilterOn).subscribe(n=>{this.chats=n})}setGroupFilter(){this.groupFilterOn=!this.groupFilterOn,this.filterGroupsSubscription=this.chatQuery.filterData(this.searchTerm,this.groupFilterOn).subscribe(t=>{this.chats=t})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Q),e.Y36(we),e.Y36(f.ez),e.Y36(N.a))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-chat"]],features:[e._Bn([f.ez])],decls:19,vars:11,consts:[[3,"specialOrStandart","megaMenuItemStandart"],["slot","main"],[1,"mb-8"],[3,"submit"],[1,"grid"],[1,"col-12"],[1,"p-float-label"],["id","float-input","type","text","pInputText","","data-cy","filter-chats",1,"w-full","p-inputtext",3,"value"],["searchBar",""],["for","float-input"],[1,"w-full","text-center"],["class","","label","POLITY GRUPPEN","styleClass","cursor-pointer",3,"click",4,"ngIf"],["class","","label","POLITY GRUPPEN","styleClass","cursor-pointer accent-container",3,"click",4,"ngIf"],[3,"error","loading","errorMessage","retryAction"],["infiniteScroll","",3,"infiniteScrollDistance","infiniteScrollUpDistance","infiniteScrollThrottle","scrolled",4,"ngIf"],["slot","side"],[3,"specialOrStandart","menuItemsStandart"],["label","POLITY GRUPPEN","styleClass","cursor-pointer",1,"",3,"click"],["label","POLITY GRUPPEN","styleClass","cursor-pointer accent-container",1,"",3,"click"],["infiniteScroll","",3,"infiniteScrollDistance","infiniteScrollUpDistance","infiniteScrollThrottle","scrolled"],[4,"ngFor","ngForOf"],[3,"chat"]],template:function(t,n){if(1&t){const r=e.EpF();e._UZ(0,"app-menu-bar-secondary-top",0),e.TgZ(1,"app-wrapper-grid")(2,"div",1)(3,"div",2)(4,"form",3),e.NdJ("submit",function(){e.CHM(r);const c=e.MAs(9);return e.KtG(n.onSearch(c.value))}),e.TgZ(5,"div",4)(6,"div",5)(7,"span",6),e._UZ(8,"input",7,8),e.TgZ(10,"label",9),e._uU(11,"Search"),e.qZA()()()()(),e.TgZ(12,"div",10),e.YNc(13,Ne,1,0,"p-chip",11),e.YNc(14,Ze,1,0,"p-chip",12),e.qZA(),e.TgZ(15,"app-loading-spinner",13),e.NdJ("retryAction",function(){return n.loadInitialData()}),e.qZA(),e.YNc(16,Oe,2,4,"div",14),e.qZA()(),e.TgZ(17,"div",15),e._UZ(18,"app-menu-bar-secondary-right",16),e.qZA()()}2&t&&(e.Q6J("specialOrStandart",!1)("megaMenuItemStandart",n.menuItemsMega),e.xp6(8),e.Q6J("value",""),e.xp6(5),e.Q6J("ngIf",!n.groupFilterOn),e.xp6(1),e.Q6J("ngIf",n.groupFilterOn),e.xp6(1),e.Q6J("error",n.error)("loading",n.loadingInitial)("errorMessage",n.errorMessage),e.xp6(1),e.Q6J("ngIf",!n.loadingInitial&&!n.error),e.xp6(2),e.Q6J("specialOrStandart",!1)("menuItemsStandart",n.menuItems))},dependencies:[p.sg,p.O5,u._Y,u.JL,u.F,I.A,Z.o,A.V,L.e,q.U,xe,Y.g,C.Ry]}),i})();var Fe=a(5933),Me=a(734),G=a(6679);function Ue(i,s){1&i&&e._UZ(0,"p-tag",16)}function ke(i,s){if(1&i&&e._UZ(0,"p-tag",17),2&i){const t=e.oxw();e.s9C("value",t.news.type)}}function Je(i,s){if(1&i&&e._UZ(0,"p-tag",18),2&i){const t=e.oxw();e.s9C("value",t.news.type)}}function Pe(i,s){if(1&i&&e._UZ(0,"p-tag",19),2&i){const t=e.oxw();e.s9C("value",t.news.type)}}function De(i,s){if(1&i&&e._UZ(0,"p-tag",19),2&i){const t=e.oxw();e.s9C("value",t.news.type)}}function Qe(i,s){if(1&i&&e._UZ(0,"p-tag",17),2&i){const t=e.oxw();e.s9C("value",t.news.type)}}function Le(i,s){if(1&i&&(e.TgZ(0,"p",20),e._uU(1),e.ALo(2,"date"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(e.lcZ(2,1,t.news.created_at))}}function qe(i,s){if(1&i&&(e.TgZ(0,"p",20),e._uU(1),e.ALo(2,"date"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.hij("",e.xi3(2,1,t.news.created_at,"HH:mm:ss")," Uhr")}}let Ee=(()=>{class i{constructor(t){this.router=t,this.showTime=!1}ngOnInit(){this.checkIfMessageReceivedToday()}openProfile(){this.router.navigateByUrl(`/profile/${this.news.notifier}`)}openConnectedId(){this.router.navigateByUrl(`/profile/${this.news.notifier}`)}checkIfMessageReceivedToday(){const t=(new Date).setHours(0,0,0,0),n=new Date(this.news.created_at).setHours(0,0,0,0);console.log(t),console.log(n),t===n&&(this.showTime=!0)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h.F0))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-news-list-item"]],inputs:{news:"news"},decls:23,vars:12,consts:[[1,"flex","w-full"],[1,"flex-space-arround","p-2","w-full"],[1,"flex","align-items-center","w-full"],[1,"flex-none","mr-5","cursor-pointer",3,"click"],["shape","circle","styleClass","border-round",3,"image"],[1,"flex-grow-1","mr-5","cursor-pointer",3,"click"],[1,"my-0"],[1,"mt-1","mb-0"],[1,"flex-none","p-2","cursor-pointer",3,"click"],[1,"flex-space-between"],[1,"text-center"],["value","NEW","styleClass","success-container font-normal success-color mr-2",4,"ngIf"],["styleClass","primary-container font-normal primary-color",3,"value",4,"ngIf"],["styleClass","accent-container-2 font-normal accent-color-2",3,"value",4,"ngIf"],["styleClass","tertiary-container font-normal tertiary-color",3,"value",4,"ngIf"],["class","mb-0",4,"ngIf"],["value","NEW","styleClass","success-container font-normal success-color mr-2"],["styleClass","primary-container font-normal primary-color",3,"value"],["styleClass","accent-container-2 font-normal accent-color-2",3,"value"],["styleClass","tertiary-container font-normal tertiary-color",3,"value"],[1,"mb-0"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"a",3),e.NdJ("click",function(){return n.openProfile()}),e._UZ(4,"p-avatar",4),e.qZA(),e.TgZ(5,"a",5),e.NdJ("click",function(){return n.openConnectedId()}),e.TgZ(6,"h4",6),e._uU(7),e.qZA(),e.TgZ(8,"p",7),e._uU(9),e.qZA()(),e.TgZ(10,"a",8),e.NdJ("click",function(){return n.openConnectedId()}),e.TgZ(11,"div",9)(12,"div",10)(13,"div"),e.YNc(14,Ue,1,0,"p-tag",11),e.YNc(15,ke,1,1,"p-tag",12),e.YNc(16,Je,1,1,"p-tag",13),e.YNc(17,Pe,1,1,"p-tag",14),e.YNc(18,De,1,1,"p-tag",14),e.YNc(19,Qe,1,1,"p-tag",12),e.qZA(),e.TgZ(20,"div"),e.YNc(21,Le,3,3,"p",15),e.YNc(22,qe,3,4,"p",15),e.qZA()()()()()()()),2&t&&(e.xp6(4),e.s9C("image",n.news.avatar_url),e.xp6(3),e.AsE("",n.news.name," || ",n.news.title,""),e.xp6(2),e.Oqu(n.news.message),e.xp6(5),e.Q6J("ngIf",n.news.new),e.xp6(1),e.Q6J("ngIf","task"===n.news.type),e.xp6(1),e.Q6J("ngIf","amendment"===n.news.type),e.xp6(1),e.Q6J("ngIf","event"===n.news.type),e.xp6(1),e.Q6J("ngIf","group"===n.news.type),e.xp6(1),e.Q6J("ngIf","account"===n.news.type),e.xp6(2),e.Q6J("ngIf",!n.showTime),e.xp6(1),e.Q6J("ngIf",n.showTime))},dependencies:[p.O5,v.q,G.V,p.uU]}),i})();var S=a(2453),Ye=a(9784);let Ge=(()=>{class i{constructor(t,n){this.swPush=t,this.authentificationQuery=n,this.VAPID_PUBLIC_KEY="BJQhdOCOkmXaJaYhaJxM69Ju6aOFdTgW0p64hpefnNZ74MFsvEu90ToMPzr5z1P9NIsAp5TS8znGgZ2DSBIOrmE",this.supabaseClient=(0,y.eI)(g.N.supabaseUrl,g.N.supabaseKey)}ngOnInit(){this.authSubscription=this.authentificationQuery.uuid$.subscribe(t=>{this.loggedInUserId=t})}subscribeToNotifications(){var t=this;return(0,l.Z)(function*(){console.log("clicked"),t.swPush.requestSubscription({serverPublicKey:t.VAPID_PUBLIC_KEY}).then(n=>{console.log("swPUsh",n),n&&t.addPushSubscriber(n).then(r=>{console.log("finished database insert",r)}).catch(r=>{console.log("failed database insert",r)})}).catch(n=>console.error("Could not subscribe to notifications",n))})()}addPushSubscriber(t){var n=this;return(0,l.Z)(function*(){console.log("endpoint",t.endpoint),console.log("adding this to database",t);const r=yield n.supabaseClient.rpc("insert_into_push_notifications",{endpoint_in:t.endpoint,expiration_time_in:t.expirationTime,p256dh_in:t.p256dh,auth_in:t.auth,user_id_in:n.loggedInUserId});if(r.error)throw new Error(r.error.message);return r})()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(Ye.Mk),e.Y36(w.c))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-push-notifications"]],decls:2,vars:0,consts:[["styleClass","max-w-90","position","top-right"],["data-cy","subscribeToPushNotifications","pButton","","type","button","label","Request push",3,"click"]],template:function(t,n){1&t&&(e._UZ(0,"p-toast",0),e.TgZ(1,"button",1),e.NdJ("click",function(){return n.subscribeToNotifications()}),e.qZA())},dependencies:[b.Hq,S.FN]}),i})();function Ve(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"p-chip",26),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.setTaskFilter())}),e.qZA()}}function Be(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"p-chip",27),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.setTaskFilter())}),e.qZA()}}function ze(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"p-chip",28),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.setGroupFilter())}),e.qZA()}}function He(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"p-chip",29),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.setGroupFilter())}),e.qZA()}}function Ke(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"p-chip",30),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.setAmendmentFilter())}),e.qZA()}}function $e(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"p-chip",31),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.setAmendmentFilter())}),e.qZA()}}function je(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"p-chip",32),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.setEventFilter())}),e.qZA()}}function We(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"p-chip",33),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.setEventFilter())}),e.qZA()}}function Xe(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"p-chip",34),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.setAccountFilter())}),e.qZA()}}function et(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"p-chip",35),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.setAccountFilter())}),e.qZA()}}function tt(i,s){if(1&i){const t=e.EpF();e.TgZ(0,"div",37),e.NdJ("scrolled",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.loadNewData())}),e._UZ(1,"app-news-list-item",38),e.qZA()}if(2&i){const t=s.$implicit;e.Q6J("infiniteScrollDistance",1)("infiniteScrollUpDistance",1.5)("infiniteScrollThrottle",50),e.xp6(1),e.Q6J("news",t)}}function it(i,s){if(1&i&&(e.TgZ(0,"div"),e.YNc(1,tt,2,4,"div",36),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.newsList.slice(t.paginationData.from,t.paginationData.to))}}const rt=[{path:"",component:Re,canActivate:[T.u]},{path:"news",component:(()=>{class i{constructor(t,n,r,o,c){this.messageService=t,this.newsService=n,this.newsQuery=r,this.paginationService=o,this.profileService=c,this.menuItems=k,this.menuItemsMega=J,this.newsList=[],this.taskFilterOn=!1,this.amendmentFilterOn=!1,this.eventFilterOn=!1,this.groupFilterOn=!1,this.accountFilterOn=!1,this.paginationData={from:0,to:4,canLoad:!0,reloadDelay:2e3,sizeOfNewLoad:10,numberOfSearchResults:0},this.errorMessage="",this.error=!1,this.loadingInitial=!1}ngOnInit(){this.loadInitialData(),this.newsService.resetUnreadNotificationsCounter()}ngOnDestroy(){var t=this;return(0,l.Z)(function*(){t.newsSubscription&&t.newsSubscription.unsubscribe(),t.newsUsersFilterSubscription&&t.newsUsersFilterSubscription.unsubscribe(),t.newsRealTimeSubscription&&t.newsRealTimeSubscription.unsubscribe(),t.newsGroupsFilterSubscription&&t.newsGroupsFilterSubscription.unsubscribe();try{yield t.newsService.resetNotificationsCounter(),yield t.newsService.markNotificationsAsUnread(),yield t.newsService.markNotificationsAsUnreadFromGroup()}catch{t.messageService.add({severity:"success",summary:"success"})}})()}loadNewData(){this.paginationData=this.paginationService.scrollDownAndLoadAscending(this.paginationData)}onSearch(t){}setTaskFilter(){this.taskFilterOn=!this.taskFilterOn}setAmendmentFilter(){this.amendmentFilterOn=!this.amendmentFilterOn}setEventFilter(){this.eventFilterOn=!this.eventFilterOn}setGroupFilter(){this.groupFilterOn=!this.groupFilterOn,this.groupFilterOn?this.newsGroupsFilterSubscription=this.newsQuery.filterNewsByType("groups").subscribe(t=>{this.newsList=t,this.paginationData.numberOfSearchResults=this.newsList.length}):this.subscribeAllNews()}setAccountFilter(){this.accountFilterOn=!this.accountFilterOn,this.accountFilterOn?this.newsUsersFilterSubscription=this.newsQuery.filterNewsByType("account").subscribe(t=>{this.newsList=t,this.paginationData.numberOfSearchResults=this.newsList.length}):this.subscribeAllNews()}subscribeAllNews(){this.newsSubscription=this.newsQuery.allNews$.subscribe(t=>{this.newsList=t,this.paginationData.numberOfSearchResults=this.newsList.length,console.log("loaded news"),console.log(this.newsList)})}loadInitialData(){var t=this;return(0,l.Z)(function*(){t.newsService.resetUnreadNotificationsCounter();try{t.loadingInitial=!0,t.error=!1,t.newsRealTimeSubscription=t.newsService.getRealTimeChangesNews(),yield t.newsService.getAllNotifications(),t.subscribeAllNews(),t.messageService.add({severity:"success",summary:"success"})}catch(n){t.error=!0,t.errorMessage=n.message,t.messageService.add({severity:"error",summary:n.message})}finally{t.loadingInitial=!1}})()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(f.ez),e.Y36(Fe.Y),e.Y36(Me.C),e.Y36(N.a),e.Y36(U.H))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-news"]],features:[e._Bn([f.ez])],decls:31,vars:19,consts:[["styleClass","max-w-90","position","top-right"],[3,"specialOrStandart","megaMenuItemStandart"],["slot","main"],[1,"mb-8"],[3,"submit"],[1,"grid"],[1,"col-12"],[1,"p-float-label"],["id","float-input","type","text","pInputText","",1,"w-full","p-inputtext",3,"value"],["searchBar",""],["for","float-input"],[1,"w-full","text-center"],["label","TASKS","styleClass","mr-1 mb-1 cursor-pointer accent-container",3,"click",4,"ngIf"],["label","TASKS","styleClass","mr-1 mb-1 cursor-pointer",3,"click",4,"ngIf"],["label","GROUP","styleClass","mr-1 mb-1 cursor-pointer accent-container",3,"click",4,"ngIf"],["label","GROUP","styleClass","mr-1 mb-1 cursor-pointer",3,"click",4,"ngIf"],["label","AMENDMENTS","styleClass","mr-1 mb-1 cursor-pointer accent-container",3,"click",4,"ngIf"],["label","AMENDMENTS","styleClass","mr-1 mb-1 cursor-pointer",3,"click",4,"ngIf"],["label","EVENT","styleClass","mr-1 mb-1 cursor-pointer accent-container",3,"click",4,"ngIf"],["label","EVENT","styleClass","mr-1 mb-1 cursor-pointer",3,"click",4,"ngIf"],["label","ACCOUNT","styleClass","mr-1 mb-1  cursor-pointer accent-container",3,"click",4,"ngIf"],["label","ACCOUNT","styleClass","mr-1 mb-1 cursor-pointer",3,"click",4,"ngIf"],[3,"error","loading","errorMessage","retryAction"],[4,"ngIf"],["slot","side"],[3,"specialOrStandart","menuItemsStandart"],["label","TASKS","styleClass","mr-1 mb-1 cursor-pointer accent-container",3,"click"],["label","TASKS","styleClass","mr-1 mb-1 cursor-pointer",3,"click"],["label","GROUP","styleClass","mr-1 mb-1 cursor-pointer accent-container",3,"click"],["label","GROUP","styleClass","mr-1 mb-1 cursor-pointer",3,"click"],["label","AMENDMENTS","styleClass","mr-1 mb-1 cursor-pointer accent-container",3,"click"],["label","AMENDMENTS","styleClass","mr-1 mb-1 cursor-pointer",3,"click"],["label","EVENT","styleClass","mr-1 mb-1 cursor-pointer accent-container",3,"click"],["label","EVENT","styleClass","mr-1 mb-1 cursor-pointer",3,"click"],["label","ACCOUNT","styleClass","mr-1 mb-1  cursor-pointer accent-container",3,"click"],["label","ACCOUNT","styleClass","mr-1 mb-1 cursor-pointer",3,"click"],["infiniteScroll","","data-cy","newsContainer",3,"infiniteScrollDistance","infiniteScrollUpDistance","infiniteScrollThrottle","scrolled",4,"ngFor","ngForOf"],["infiniteScroll","","data-cy","newsContainer",3,"infiniteScrollDistance","infiniteScrollUpDistance","infiniteScrollThrottle","scrolled"],[3,"news"]],template:function(t,n){if(1&t){const r=e.EpF();e.TgZ(0,"p-toast",0),e._uU(1,">"),e.qZA(),e._UZ(2,"app-menu-bar-secondary-top",1),e.TgZ(3,"app-wrapper-grid")(4,"div",2)(5,"div",3)(6,"form",4),e.NdJ("submit",function(){e.CHM(r);const c=e.MAs(11);return e.KtG(n.onSearch(c.value))}),e.TgZ(7,"div",5)(8,"div",6)(9,"span",7),e._UZ(10,"input",8,9),e.TgZ(12,"label",10),e._uU(13,"Search"),e.qZA()()()()(),e.TgZ(14,"div",11),e._UZ(15,"app-push-notifications"),e.qZA(),e.TgZ(16,"div",11),e.YNc(17,Ve,1,0,"p-chip",12),e.YNc(18,Be,1,0,"p-chip",13),e.YNc(19,ze,1,0,"p-chip",14),e.YNc(20,He,1,0,"p-chip",15),e.YNc(21,Ke,1,0,"p-chip",16),e.YNc(22,$e,1,0,"p-chip",17),e.YNc(23,je,1,0,"p-chip",18),e.YNc(24,We,1,0,"p-chip",19),e.YNc(25,Xe,1,0,"p-chip",20),e.YNc(26,et,1,0,"p-chip",21),e.qZA(),e.TgZ(27,"app-loading-spinner",22),e.NdJ("retryAction",function(){return n.loadInitialData()}),e.qZA(),e.YNc(28,it,2,1,"div",23),e.qZA()(),e.TgZ(29,"div",24),e._UZ(30,"app-menu-bar-secondary-right",25),e.qZA()()}2&t&&(e.xp6(2),e.Q6J("specialOrStandart",!1)("megaMenuItemStandart",n.menuItemsMega),e.xp6(8),e.Q6J("value",""),e.xp6(7),e.Q6J("ngIf",n.taskFilterOn),e.xp6(1),e.Q6J("ngIf",!n.taskFilterOn),e.xp6(1),e.Q6J("ngIf",n.groupFilterOn),e.xp6(1),e.Q6J("ngIf",!n.groupFilterOn),e.xp6(1),e.Q6J("ngIf",n.amendmentFilterOn),e.xp6(1),e.Q6J("ngIf",!n.amendmentFilterOn),e.xp6(1),e.Q6J("ngIf",n.eventFilterOn),e.xp6(1),e.Q6J("ngIf",!n.eventFilterOn),e.xp6(1),e.Q6J("ngIf",n.accountFilterOn),e.xp6(1),e.Q6J("ngIf",!n.accountFilterOn),e.xp6(1),e.Q6J("error",n.error)("loading",n.loadingInitial)("errorMessage",n.errorMessage),e.xp6(1),e.Q6J("ngIf",!n.loadingInitial&&!n.error),e.xp6(2),e.Q6J("specialOrStandart",!1)("menuItemsStandart",n.menuItems))},dependencies:[p.sg,p.O5,I.A,A.V,q.U,L.e,Ee,S.FN,C.Ry,Y.g,Ge],styles:[".test[_ngcontent-%COMP%]{width:300px;height:300px}"]}),i})(),canActivate:[T.u]},{path:":id",component:ye,canActivate:[T.u]}];let st=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[h.Bz.forChild(rt),h.Bz]}),i})();var V=a(5480),O=a(3943),B=a(5604);let ot=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[p.ez,v.F,G.W]}),i})();var z=a(6609);let at=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[p.ez,b.hJ,S.EV]}),i})(),ct=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[p.ez,I.o,V.x,O.q,B.Q,O.q,ot,S.EV,C.Rq,z.z,at]}),i})();var lt=a(989);let pt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[p.ez]}),i})(),ut=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[p.ez,E.TX,v.F]}),i})();var H=a(1333);let _t=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[p.ez,H.Cl],f.m8,H.Cl]}),i})(),vt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[p.ez,st,u.u5,I.o,v.F,Z.j,b.hJ,V.x,B.Q,O.q,ct,lt.n,pt,ut,z.z,_t,C.Rq]}),i})()}}]);