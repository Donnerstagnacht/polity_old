"use strict";(self.webpackChunkpolity=self.webpackChunkpolity||[]).push([[10],{9469:(M,p,n)=>{n.d(p,{W:()=>d});var o=n(8274),m=n(8492);let d=(()=>{class i{constructor(){this.title="",this.link=""}ngOnInit(){}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275cmp=o.Xpm({type:i,selectors:[["app-back-button"]],inputs:{title:"title",link:"link"},decls:5,vars:2,consts:[[1,"flex","flex-row",3,"routerLink"],[1,"pi","pi-arrow-left","align-items-center","flex","justify-content-center","mr-4","on-dark-surface-in-dark-theme"],[1,"flex","align-items-center","justify-content-center"]],template:function(a,u){1&a&&(o.TgZ(0,"div")(1,"a",0),o._UZ(2,"i",1),o.TgZ(3,"h4",2),o._uU(4),o.qZA()()()),2&a&&(o.xp6(1),o.s9C("routerLink",u.link),o.xp6(3),o.Oqu(u.title))},dependencies:[m.yS],styles:["a[_ngcontent-%COMP%]{text-decoration:none;color:#000}"]}),i})()},989:(M,p,n)=>{n.d(p,{n:()=>i});var o=n(6895),m=n(8492),d=n(8274);let i=(()=>{class l{}return l.\u0275fac=function(u){return new(u||l)},l.\u0275mod=d.oAB({type:l}),l.\u0275inj=d.cJS({imports:[o.ez,m.Bz]}),l})()},4479:(M,p,n)=>{n.d(p,{e:()=>u});var o=n(8274),m=n(6895),d=n(1327),i=n(8492);function l(c,_){if(1&c&&o._UZ(0,"p-menu",4),2&c){const h=o.oxw();o.Q6J("model",h.menuItemsSpecial)}}function a(c,_){if(1&c&&o._UZ(0,"p-menu",4),2&c){const h=o.oxw();o.Q6J("model",h.menuItemsStandart)}}let u=(()=>{class c{constructor(){this.menuItemsSpecial=[],this.menuItemsStandart=[],this.specialOrStandart=!1,this.menuItems=[]}ngOnInit(){}}return c.\u0275fac=function(h){return new(h||c)},c.\u0275cmp=o.Xpm({type:c,selectors:[["app-menu-bar-secondary-right"]],inputs:{menuItemsSpecial:"menuItemsSpecial",menuItemsStandart:"menuItemsStandart",specialOrStandart:"specialOrStandart",menuItems:"menuItems"},decls:5,vars:2,consts:[[1,""],[1,"flex"],[1,"flex","align-items-center","justify-content-center","h-screen","w-full"],["routerLinkActive","p-menuitem-link-active","class","fixed",3,"model",4,"ngIf"],["routerLinkActive","p-menuitem-link-active",1,"fixed",3,"model"]],template:function(h,e){1&h&&(o.TgZ(0,"div",0)(1,"div",1)(2,"div",2),o.YNc(3,l,1,1,"p-menu",3),o.YNc(4,a,1,1,"p-menu",3),o.qZA()()()),2&h&&(o.xp6(3),o.Q6J("ngIf",e.specialOrStandart),o.xp6(1),o.Q6J("ngIf",!e.specialOrStandart))},dependencies:[m.O5,d.v2,i.Od]}),c})()},5604:(M,p,n)=>{n.d(p,{Q:()=>l});var o=n(6895),m=n(3214),d=n(1327),i=n(8274);let l=(()=>{class a{}return a.\u0275fac=function(c){return new(c||a)},a.\u0275mod=i.oAB({type:a}),a.\u0275inj=i.cJS({imports:[o.ez,m.l,d.$9]}),a})()},4524:(M,p,n)=>{n.d(p,{U:()=>c});var o=n(8274),m=n(6895),d=n(450),i=n(3214);function l(_,h){if(1&_&&o._UZ(0,"p-megaMenu",3),2&_){const e=o.oxw();o.Q6J("model",e.megaMenuItemSpecial)}}function a(_,h){if(1&_&&o._UZ(0,"p-megaMenu",3),2&_){const e=o.oxw();o.Q6J("model",e.megaMenuItemStandart)}}const u=function(){return{height:"inherit"}};let c=(()=>{class _{constructor(){this.menuItems=[],this.megaMenuItemSpecial=[],this.megaMenuItemStandart=[],this.specialOrStandart=!1,this.loggedIn=!1}ngOnInit(){}}return _.\u0275fac=function(e){return new(e||_)},_.\u0275cmp=o.Xpm({type:_,selectors:[["app-menu-bar-secondary-top"]],inputs:{menuItems:"menuItems",megaMenuItemSpecial:"megaMenuItemSpecial",megaMenuItemStandart:"megaMenuItemStandart",specialOrStandart:"specialOrStandart"},decls:4,vars:8,consts:[["position","top","header","none",3,"visible","showCloseIcon","modal"],[1,"flex","justify-content-around"],[3,"model",4,"ngIf"],[3,"model"]],template:function(e,r){1&e&&(o.TgZ(0,"p-sidebar",0)(1,"div",1),o.YNc(2,l,1,1,"p-megaMenu",2),o.YNc(3,a,1,1,"p-megaMenu",2),o.qZA()()),2&e&&(o.Akn(o.DdM(7,u)),o.Q6J("visible",!0)("showCloseIcon",!1)("modal",!1),o.xp6(2),o.Q6J("ngIf",r.specialOrStandart),o.xp6(1),o.Q6J("ngIf",!r.specialOrStandart))},dependencies:[m.O5,d.V,i.Y]}),_})()},3943:(M,p,n)=>{n.d(p,{q:()=>l});var o=n(6895),m=n(450),d=n(3214),i=n(8274);let l=(()=>{class a{}return a.\u0275fac=function(c){return new(c||a)},a.\u0275mod=i.oAB({type:a}),a.\u0275inj=i.cJS({imports:[o.ez,m.r,d.l]}),a})()},8092:(M,p,n)=>{n.d(p,{V:()=>i});var o=n(8274);const m=[[["","slot","main"]],[["","slot","side"]]],d=["[slot=main]","[slot=side]"];let i=(()=>{class l{constructor(){this.noTopBar=!1}ngOnInit(){}}return l.\u0275fac=function(u){return new(u||l)},l.\u0275cmp=o.Xpm({type:l,selectors:[["app-wrapper-grid"]],inputs:{noTopBar:"noTopBar"},ngContentSelectors:d,decls:7,vars:2,consts:[[1,"grid","surface"],[1,"col-12","md:col-12","lg:col-8","lg:col-offset-2"],[1,"lg:col-2","show-large"]],template:function(u,c){1&u&&(o.F$t(m),o.TgZ(0,"div",0)(1,"div",1)(2,"div")(3,"div"),o.Hsn(4),o.qZA()()(),o.TgZ(5,"div",2),o.Hsn(6,1),o.qZA()()),2&u&&(o.xp6(3),o.ekj("mt-9",!c.noTopBar))},styles:[".grid[_ngcontent-%COMP%]{margin-right:0rem!important;margin-left:0rem!important;margin-top:0rem!important}"]}),l})()},5480:(M,p,n)=>{n.d(p,{x:()=>d});var o=n(6895),m=n(8274);let d=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=m.oAB({type:i}),i.\u0275inj=m.cJS({imports:[o.ez]}),i})()},4593:(M,p,n)=>{n.d(p,{g:()=>c});var o=n(5861),m=n(5813),d=n(2340),i=n(8274),l=n(6469),a=n(4576),u=n(1992);let c=(()=>{class _{constructor(e,r,t,s){this.persistStorage=e,this.authentificationStore=r,this.profileStore=t,this.groupStore=s,this.supabaseClient=(0,m.eI)(d.N.supabaseUrl,d.N.supabaseKey)}signIn(e,r){var t=this;return(0,o.Z)(function*(){const s=yield t.supabaseClient.auth.signIn({email:e,password:r});if(s.error)throw new Error(s.error.message);t.authentificationStore.update({sessionResponse:s,uuid:s.user?.id})})()}signOut(){var e=this;return(0,o.Z)(function*(){const r=yield e.supabaseClient.auth.signOut();if(e.authentificationStore.reset(),e.profileStore.reset(),e.groupStore.reset(),e.groupStore.resetUIStore(),e.profileStore.resetUIStore(),e.persistStorage.clear(),r.error)throw new Error(r.error.message)})()}signUp(e){var r=this;return(0,o.Z)(function*(){const t=e.email,s=e.password,E=yield r.supabaseClient.auth.signUp({email:t,password:s});if(E.error)throw new Error(E.error.message)})()}}return _.\u0275fac=function(e){return new(e||_)(i.LFG("persistStorage"),i.LFG(l.q),i.LFG(a.s),i.LFG(u.M))},_.\u0275prov=i.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},8365:(M,p,n)=>{n.d(p,{$:()=>i});var o=n(6130),m=n(8274),d=n(1992);let i=(()=>{class l extends o.Gv{constructor(u){super(u),this.store=u,this.createUIQuery()}selectUI$(u){return this.ui.selectEntity(u)}}return l.\u0275fac=function(u){return new(u||l)(m.LFG(d.M))},l.\u0275prov=m.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"}),l})()},2545:(M,p,n)=>{n.d(p,{J:()=>c});var o=n(5861),m=n(9730),d=n(5813),i=n(2340),l=n(8274),a=n(8365),u=n(1992);let c=(()=>{class _ extends m.Hb{constructor(e,r){super(r),this.groupsQuery=e,this.groupsStore=r,this.supabaseClient=(0,d.eI)(i.N.supabaseUrl,i.N.supabaseKey)}findGroup(e){this.selectGroup(e).then(r=>{let t=r.data;console.log("Data received from backend"),console.log(t),this.groupsStore.add(t)}).catch(r=>{console.log(r)})}getRealTimeChanges(e){return this.supabaseClient.from(`groups:id=eq.${e}`).on("UPDATE",t=>{this.groupsStore.update(t.new.id,t.new)}).subscribe()}updateGroup(e,r){const t={...e};let s=e.id;return r&&(s=r),console.log("updated"),console.log(e),console.log(s),console.log(t),this.supabaseClient.from("groups").update(e,{returning:"minimal"}).match({id:s})}selectGroup(e){var r=this;return(0,o.Z)(function*(){let t=yield r.supabaseClient.from("groups").select("id,\n        name,\n        description,\n        avatar_url,\n        contact_email,\n        contact_phone,\n        street,\n        post_code,\n        city,\n        level,\n        amendment_counter,\n        follower_counter,\n        events_counter,\n        member_counter").eq("id",e).single();return t.data.members=[],t.data.membership_requests=[],t})()}getAllMembers(e){this.selectAllMembers(e).then(r=>{let t=[];r.data.forEach(s=>{t.push({id:s.id,user_id:s.user_id,avatar_url:s.profiles.avatar_url,name:s.profiles.name})}),this.groupsStore.update(e,{members:t})})}getAllFollowers(e){this.getAllFollower(e).then(r=>{console.log("response"),console.log(r);let t=[];r.data.forEach(s=>{t.push({id:s.id,user_id:s.follower,avatar_url:s.profiles.avatar_url,name:s.profiles.name})}),this.groupsStore.update(e,{followers:t})}).catch(r=>console.log(r))}getAllGroupFollowingsOfUser(e){this.getAllFollowings(e).then(r=>{console.log("response"),console.log(r);let t=[];r.data.forEach(s=>{t.push({id:s.id,user_id:s.follower,avatar_url:s.profiles.avatar_url,name:s.profiles.name})}),this.groupsStore.update(e,{followers:t})}).catch(r=>console.log(r))}getAllMemberShipRequests(e){this.getAllMembershipRequests(e).then(r=>{console.log("response"),console.log(r);let t=[];r.data.forEach(s=>{t.push({id:s.id,user_id:s.user_requests,avatar_url:s.profiles.avatar_url,name:s.profiles.name})}),this.groupsStore.update(e,{membership_requests:t})})}selectAllMembers(e){var r=this;return(0,o.Z)(function*(){return yield r.supabaseClient.from("group_members").select("id,\n      user_id,\n      profiles!group_members_user_id_fkey (\n        id,\n        name,\n        avatar_url\n      )").eq("group_id",e)})()}getRealTimeChangesMembershipRequests(e){return console.log("test 2 activated"),this.supabaseClient.from("membership_requests").on("INSERT",t=>{console.log("Payload"),console.log(t),t.new.group_requested===e&&this.selectProfile(t.new.user_requests).then(s=>{console.log(s),console.log(s.data.id),console.log(s.data.name),console.log(s.data.avatar_url),console.log();let E={id:t.new.id,user_id:s.data.id,avatar_url:s.data.avatar_url,name:s.data.name};console.log(E);const g=this.groupsQuery.getEntity(e);if(console.log("oldState"),console.log(g?.membership_requests),g&&g.membership_requests){const f=Object.assign([],g.membership_requests);f.push(E),console.log("newState"),console.log(f),this.groupsStore.update(e,{membership_requests:f})}})}).on("DELETE",t=>{if(console.log("Payload"),console.log(t),t.old.group_requested===e){console.log(t.old.id);const s=this.groupsQuery.getEntity(e);if(console.log("oldState"),console.log(s),s&&s.membership_requests){const E=Object.assign([],s.membership_requests);let g=E.findIndex(f=>f.id===t.old.id);E.splice(g),console.log("newState"),console.log(g),console.log(t.old.id),console.log(E),this.groupsStore.update(e,{membership_requests:E})}}}).subscribe()}getRealTimeChangesMembers(e){return console.log("activated Get Members"),this.supabaseClient.from("group_members").on("INSERT",t=>{console.log("Payload"),console.log(t),t.new.group_id===e&&this.selectMember(e,t.new.user_id).then(s=>{console.log(s),console.log(s.data[0].id),console.log(s.data[0].user_id),console.log(s.data[0].profiles.name),console.log(s.data[0].profiles.avatar_url),console.log();let E={id:s.data[0].id,user_id:s.data[0].user_id,avatar_url:s.data[0].profiles.avatar_url,name:s.data[0].profiles.name};console.log(E);const g=this.groupsQuery.getEntity(e);if(console.log("oldState"),console.log(g),g&&g.members){const f=Object.assign([],g.members);f.push(E),console.log("newState"),console.log(f),this.groupsStore.update(e,{members:f})}})}).on("DELETE",t=>{console.log("Payload"),console.log(t),console.log("group.id_"),console.log(t.old.group_id),console.log(e),t.old.group_id===e&&this.selectProfile(t.old.user_id).then(s=>{console.log(s),console.log(s.data.id),console.log(s.data.name),console.log(s.data.avatar_url),console.log(),console.log({id:t.old.id,user_id:s.data.id,avatar_url:s.data.avatar_url,name:s.data.name});const g=this.groupsQuery.getEntity(e);if(console.log("oldState"),console.log(g?.members),g&&g.members){const f=Object.assign([],g.members);let v=f.findIndex(O=>O.id===t.old.id);f.splice(v),console.log("newState"),console.log(v),console.log(t.old.id),console.log(f),this.groupsStore.update(e,{members:f})}})}).subscribe()}getRealTimeChangesFollowers(e){return console.log("activated Get followers"),this.supabaseClient.from("following_group_system").on("INSERT",t=>{console.log("Payload"),console.log(t),t.new.following===e&&this.selectProfile(t.new.follower).then(s=>{console.log(s),console.log(s.data.id),console.log(s.data.name),console.log(s.data.avatar_url),console.log();let E={id:t.old.id,user_id:s.data.id,avatar_url:s.data.avatar_url,name:s.data.name};console.log(E);const g=this.groupsQuery.getEntity(e);if(console.log("oldState"),console.log(g),console.log("oldState followers"),console.log(g?.followers),g&&g.followers){const f=Object.assign([],g.followers);f.push(E),console.log("newState"),console.log(f),this.groupsStore.update(e,{followers:f})}})}).on("DELETE",t=>{console.log("Payload"),console.log(t),console.log("group.id_"),console.log(t.old.following),console.log(e),t.old.following===e&&this.selectProfile(t.old.follower).then(s=>{console.log(s),console.log(s.data.id),console.log(s.data.name),console.log(s.data.avatar_url),console.log(),console.log({id:t.old.id,user_id:s.data.id,avatar_url:s.data.avatar_url,name:s.data.name});const g=this.groupsQuery.getEntity(e);if(console.log("oldState"),console.log(g?.followers),g&&g.followers){const f=Object.assign([],g.followers);let v=f.findIndex(O=>O.id===t.old.id);f.splice(v),console.log("newState"),console.log(v),console.log(t.old.id),console.log(f),this.groupsStore.update(e,{followers:f})}})}).subscribe()}selectMember(e,r){var t=this;return(0,o.Z)(function*(){return yield t.supabaseClient.from("group_members").select("id,\n      user_id,\n      profiles!group_members_user_id_fkey (\n        id,\n        name,\n        avatar_url\n      )").eq("group_id",e).eq("user_id",r).limit(1)})()}selectProfile(e){var r=this;return(0,o.Z)(function*(){return yield r.supabaseClient.from("profiles").select("id,\n      name,\n      avatar_url\n      ").eq("id",e).single()})()}updateIsMember(e,r){this.groupsStore.ui.upsert(e,{isMember:r})}updateIsAdmin(e,r){this.groupsStore.ui.upsert(e,{isAdmin:r})}updateIsFollowing(e,r){this.groupsStore.ui.upsert(e,{isFollowing:r})}updateRequestedMembership(e,r){this.groupsStore.ui.upsert(e,{requestedMembership:r})}getAllFollower(e){var r=this;return(0,o.Z)(function*(){return yield r.supabaseClient.from("following_group_system").select("id,\n      follower,\n      profiles!following_group_system_follower_fkey (\n        id,\n        name,\n        avatar_url\n      )").eq("following",e)})()}getAllFollowings(e){var r=this;return(0,o.Z)(function*(){return yield r.supabaseClient.from("following_group_system").select("id,\n      following,\n      groups!following_group_system_following_fkey (\n        id,\n        name,\n        avatar_url\n      )").eq("follower",e)})()}getAllMembershipRequests(e){var r=this;return(0,o.Z)(function*(){return yield r.supabaseClient.from("membership_requests").select("id,\n      user_requests,\n      profiles!membership_requests_user_requests_fkey (\n        id,\n        name,\n        avatar_url\n      )").eq("group_requested",e)})()}}return _.\u0275fac=function(e){return new(e||_)(l.LFG(a.$),l.LFG(u.M))},_.\u0275prov=l.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},1992:(M,p,n)=>{n.d(p,{M:()=>a});var o=n(655),m=n(6130);const d={isFollowing:!1,isAdmin:!1,requestedMembership:!1,isMember:!1};var l=n(8274);let a=class extends m.cf{constructor(){super(),this.createUIStore({},{name:"groupsUIStore",resettable:!0}).setInitialEntityState(d)}resetUIStore(){this.ui.reset()}};a.\u0275fac=function(c){return new(c||a)},a.\u0275prov=l.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a=(0,o.gn)([(0,m.yC)({name:"groups",resettable:!0})],a)},9028:(M,p,n)=>{n.d(p,{u:()=>u});var o=n(5698),m=n(4004),d=n(8274),i=n(6923),l=n(4593),a=n(8492);let u=(()=>{class c{constructor(h,e,r){this.authentificationQuery=h,this.authentificationService=e,this.router=r}canActivate(h,e){let r;return this.authentificationQuery.uuid$.pipe((0,o.q)(1),(0,m.U)(t=>t?(r=!0,r):(this.router.navigate(["/login"]),r=!1,r)))}}return c.\u0275fac=function(h){return new(h||c)(d.LFG(i.c),d.LFG(l.g),d.LFG(a.F0))},c.\u0275prov=d.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()}}]);